

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.9. Intermediate Plotting (opt) &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/pandas/matplotlib';</script>
    <link rel="canonical" href="https://amoreira2.github.io/quantitativeinvesting/chapters/pandas/matplotlib.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.10. Storage Formats (opt)" href="storage_formats.html" />
    <link rel="prev" title="5.8. GroupBy (opt)" href="groupby.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03/programming-in-python.html">3. First Steps with Python</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/essentials.html">4. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">4.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">4.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">4.3. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">4.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy1.html">4.5. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting1.html">4.6. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="workingwithdata.html">5. Working with Data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html">5.2. Pandas Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_index.html">5.3. Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html">5.4. Time-Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_clean.html">5.5. Cleaning data (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshape.html">5.6. Reshape (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="merge.html">5.7. Merge (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html">5.8. Group-by (opt)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.9. Plotting (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage_formats.html">5.10. Data Storage (opt)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Returns.html">6. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Returns1.html">6.1. Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">6.2. Modeling randomness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TheChoiceofFrequency.html">6.3. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.4. Linear algebra Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/UsingAPI.html">6.5. Data APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/PortfolioMath.html">7. Portfolio Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/CapitalAllocationLine.html">8. Capital Allocation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/meanvariance1.html">9. Mean Variance Frontier</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MeanVariance.html">9.1. Mean Variance Efficient Portfolios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/CaseStudy.html">9.2. Case Study in International Diversification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/LeverageandShorting.html">9.3. Leverage and Shorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Portfoliooptimizationwithconstraints.html">9.4. Portfolio Optimization with constraints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/EstimationUncertainty.html">10. Estimation Uncertainty and It's Implications for investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/TradingStrategies.html">11. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Timing.html">12. Timing Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Volatilitytiming.html">12.1. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/crosssectionalequitystrategies.html">13. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Valueinvesting.html">13.1. Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Momentum.html">13.2. Momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/OtherEquityStrategies.html">13.3. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Evaluation.html">14. Evaluating a Trading Strategy</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Econometrics.html">14.1. The Econometrics of Strategy Evalaution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/outofsample.html">14.2. Out of Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TailandBackground.html">14.3. Tail Risks and Background Risks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MultiFactorModels.html">14.4. Multifactor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Topics.html">15. Topics in Quantitative Investing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Equilbrium.html">15.1. Intepreting Factor models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Implementation.html">15.2. Strategy Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Horizon.html">15.3. Investment horizon effects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">16. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">17. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">17.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">17.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">17.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">17.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">17.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">17.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">17.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">17.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Lectures/blob/main/chapters/pandas/matplotlib.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures/issues/new?title=Issue%20on%20page%20%2Fchapters/pandas/matplotlib.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/pandas/matplotlib.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Intermediate Plotting (opt)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.9.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">5.9.2. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-want-operator-replicate-a-professional-figure">5.9.3. The Want Operator: Replicate a Professional Figure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">5.9.4. Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#warmup">5.9.5. Warmup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">5.9.6. Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-plot">5.9.7. Constructing the Plot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subplot-spacing-fig-tight-layout">5.9.7.1. Subplot Spacing: <code class="docutils literal notranslate"><span class="pre">fig.tight_layout</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-figure">5.9.7.2. Properties of the Figure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-an-axes">5.9.7.3. Properties of an <code class="docutils literal notranslate"><span class="pre">Axes</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-and-lines">5.9.7.4. Transforms and Lines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annotations">5.9.7.5. Annotations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-figure">5.9.8. Saving the Figure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5.9.8.1. Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.9.9. Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="intermediate-plotting-opt">
<h1><span class="section-number">5.9. </span>Intermediate Plotting (opt)<a class="headerlink" href="#intermediate-plotting-opt" title="Permalink to this heading">#</a></h1>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="intro.html"><span class="doc std std-doc">Introduction</span></a></p></li>
</ul>
<p><strong>Outcomes</strong></p>
<ul class="simple">
<li><p>Be able to build visualizations with multiple subplots</p></li>
<li><p>Add plot elements using data from multiple DataFrames</p></li>
<li><p>Understand the relationship between the matplotlib Figure and Axes
objects</p></li>
<li><p>Customize fonts, legends, axis labels, tick labels, titles, and more!</p></li>
<li><p>Save figures to files to add to presentation, email, or use outside
of a Jupyter notebook</p></li>
</ul>
<p><strong>Data</strong></p>
<ul class="simple">
<li><p>iPhone announcement dates</p></li>
<li><p>Apple stock price</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment following line to install on colab</span>
<span class="c1">#! pip install qeds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">import</span> <span class="nn">quandl</span>

<span class="n">quandl</span><span class="o">.</span><span class="n">ApiConfig</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;QUANDL_AUTH&quot;</span><span class="p">,</span> <span class="s2">&quot;Dn6BtVoBhzuKTuyo6hbp&quot;</span><span class="p">)</span>


<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># activate plot theme</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="n">qeds</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">mpl_style</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<section id="outline">
<h2><span class="section-number">5.9.1. </span>Outline<a class="headerlink" href="#outline" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><span class="xref myst">Intermediate Plotting</span></p>
<ul>
<li><p><span class="xref myst">Introduction</span></p></li>
<li><p><span class="xref myst">The Want Operator: Replicate a Professional Figure</span></p></li>
<li><p><span class="xref myst">Data</span></p></li>
<li><p><span class="xref myst">Warmup</span></p></li>
<li><p><span class="xref myst">Data Cleaning</span></p></li>
<li><p><span class="xref myst">Constructing the Plot</span></p></li>
<li><p><span class="xref myst">Saving the Figure</span></p></li>
<li><p><span class="xref myst">Exercises</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="introduction">
<h2><span class="section-number">5.9.2. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>We have already seen a few examples of basic visualizations created
using the <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method for a DataFrame.</p>
<p>When we use the <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method, pandas uses a package called
matplotlib that actually creates the visualization.</p>
<p>In this lecture, we will dive deeper into the customization options in
the DataFrame <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method as well as look under the hood at how to
use matplotlib directly to unlock unlimited control over our figures.</p>
</section>
<section id="the-want-operator-replicate-a-professional-figure">
<h2><span class="section-number">5.9.3. </span>The Want Operator: Replicate a Professional Figure<a class="headerlink" href="#the-want-operator-replicate-a-professional-figure" title="Permalink to this heading">#</a></h2>
<p>Visualization is a complex subject.</p>
<p><a class="reference external" href="https://www.amazon.com/s/ref=nb_sb_noss?url=search-alias%3Dstripbooks&amp;field-keywords=data+visualization&amp;rh=n%3A283155%2Ck%3Adata+visualization">Many
books</a>
have been written on the subject.</p>
<p>We cannot hope to convey all of what is possible in a short lecture, so
we thought we’d try something fun instead.</p>
<p>Our goal in this lecture is to show off some of the common – and some
not-so-common – matplotlib capabilities to try to re-create this
striking figure from a Financial Times
<a class="reference external" href="https://www.ft.com/content/4743ce96-e4bf-11e7-97e2-916d4fbac0da">article</a>.</p>
<p>The figure shows how we can see the anticipation of and response to iPhone
announcements in Apple stock share prices.</p>
<img src="https://datascience.quantecon.org/assets/_static/matplotlib_files/aapl_iphone_announcments.png" alt="aapl\_iphone\_announcments.png" style="">
<p>Our goal is to replicate the top portion of this figure in this lecture.</p>
<p><strong>Disclaimer</strong>: Many tools you will see in this lecture will be
“more advanced” than what you typically use when customizing a plot.
Don’t (please!) try to memorize the commands used here – the purpose of
the lecture is to show what is possible and expose you a variety of the
methods you can use.</p>
</section>
<section id="data">
<h2><span class="section-number">5.9.4. </span>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h2>
<p>Let’s get the data.</p>
<p>First, we create a Series containing the date of each iPhone
announcement that appears in the FT original chart.</p>
<p>As there have only been 11 of them and we couldn’t find this “dataset”
online anywhere, we will do this by hand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">announcement_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;First iPhone&quot;</span><span class="p">,</span> <span class="s2">&quot;3G&quot;</span><span class="p">,</span> <span class="s2">&quot;3GS&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;4S&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;5S/5C&quot;</span><span class="p">,</span> <span class="s2">&quot;6/6 Plus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6S/6S Plus&quot;</span><span class="p">,</span> <span class="s2">&quot;7/7 Plus&quot;</span><span class="p">,</span> <span class="s2">&quot;8/8 Plus/X&quot;</span>
    <span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span>
        <span class="s2">&quot;Jan. 9, 2007&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun. 9, 2008&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun. 8, 2009&quot;</span><span class="p">,</span> <span class="s2">&quot;Jan. 11, 2011&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Oct. 4, 2011&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep. 12, 2012&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep. 10, 2013&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep. 9, 2014&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sep. 9, 2015&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep. 7, 2016&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep. 12, 2017&quot;</span>
    <span class="p">]),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span>
<span class="p">)</span>
<span class="n">announcement_dates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2007-01-09    First iPhone
2008-06-09              3G
2009-06-08             3GS
2011-01-11               4
2011-10-04              4S
2012-09-12               5
2013-09-10           5S/5C
2014-09-09        6/6 Plus
2015-09-09      6S/6S Plus
2016-09-07        7/7 Plus
2017-09-12      8/8 Plus/X
Name: Model, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Then, let’s grab Apple’s stock price data from quandl, starting a few
weeks before the first announcement.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aapl</span> <span class="o">=</span> <span class="n">quandl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WIKI/AAPL&quot;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2006-12-25&quot;</span><span class="p">)</span>
<span class="n">aapl</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Ex-Dividend</th>
      <th>Split Ratio</th>
      <th>Adj. Open</th>
      <th>Adj. High</th>
      <th>Adj. Low</th>
      <th>Adj. Close</th>
      <th>Adj. Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-12-26</th>
      <td>82.15</td>
      <td>82.57</td>
      <td>80.89</td>
      <td>81.51</td>
      <td>17524600.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10.557420</td>
      <td>10.611396</td>
      <td>10.395492</td>
      <td>10.475171</td>
      <td>122672200.0</td>
    </tr>
    <tr>
      <th>2006-12-27</th>
      <td>78.15</td>
      <td>82.00</td>
      <td>76.77</td>
      <td>81.52</td>
      <td>69134100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10.043364</td>
      <td>10.538143</td>
      <td>9.866015</td>
      <td>10.476456</td>
      <td>483938700.0</td>
    </tr>
    <tr>
      <th>2006-12-28</th>
      <td>80.22</td>
      <td>81.25</td>
      <td>79.65</td>
      <td>80.87</td>
      <td>39995600.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10.309388</td>
      <td>10.441757</td>
      <td>10.236135</td>
      <td>10.392922</td>
      <td>279969200.0</td>
    </tr>
    <tr>
      <th>2006-12-29</th>
      <td>83.95</td>
      <td>85.40</td>
      <td>83.36</td>
      <td>84.84</td>
      <td>38443900.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10.788745</td>
      <td>10.975090</td>
      <td>10.712922</td>
      <td>10.903122</td>
      <td>269107300.0</td>
    </tr>
    <tr>
      <th>2007-01-03</th>
      <td>86.29</td>
      <td>86.58</td>
      <td>81.90</td>
      <td>83.80</td>
      <td>44225700.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>11.089468</td>
      <td>11.126737</td>
      <td>10.525291</td>
      <td>10.769468</td>
      <td>309579900.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="warmup">
<h2><span class="section-number">5.9.5. </span>Warmup<a class="headerlink" href="#warmup" title="Permalink to this heading">#</a></h2>
<p>Matplotlib figures are composed two main types of Python objects:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Figure</span></code>: represents the entirety of the visualization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Axes</span></code>: A (potentially full) subset of the figure on which things
are drawn</p></li>
</ol>
<p>Most of the time, we will customize our plots by calling methods on an
Axes object.</p>
<p>However, things like setting a title over the entire plot or saving the
plot to a file on your computer require methods on a <code class="docutils literal notranslate"><span class="pre">Figure</span></code>.</p>
<p>Let’s start by getting our hands dirty and practicing using these
objects.</p>
<p><a id='exercise-0'></a></p>
<blockquote>
<div><p>See exercise 1 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>You should have seen that the object returned by the <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method is
a matplotlib Axes.</p>
<p>As mentioned above, we can control most aspects of a plot by calling
methods on an Axes.</p>
<p>Let’s see some examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the Adjusted open to account for stock split</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">aapl</span><span class="p">[</span><span class="s2">&quot;Adj. Open&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># get the figure so we can re-display the plot after making changes</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3a17969b63f3d16f314c530cef31175128f285cb25aef2c000327a2dc54263b0.png" src="../../_images/3a17969b63f3d16f314c530cef31175128f285cb25aef2c000327a2dc54263b0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;AAPL Adjusted opening price&quot;</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2c85383ff4c3a75cd11988ce51a64a3a8ef2b5bc100a1cc5996d82effb7ad40d.png" src="../../_images/2c85383ff4c3a75cd11988ce51a64a3a8ef2b5bc100a1cc5996d82effb7ad40d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/81554ce80bd0ee1c25c2a69bed77151d3387021efeca0d2f5e81cf138275ad9b.png" src="../../_images/81554ce80bd0ee1c25c2a69bed77151d3387021efeca0d2f5e81cf138275ad9b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/891d8993822535255b432d86aa6d6d045fdde33b60518e911f4cc463208cd311.png" src="../../_images/891d8993822535255b432d86aa6d6d045fdde33b60518e911f4cc463208cd311.png" />
</div>
</div>
<p>We can also create a Figure and Axes beforehand and then tell pandas to
plot a DataFrame or Series’ data on the axis.</p>
<p>We typically use the <code class="docutils literal notranslate"><span class="pre">plt.subplots</span></code> function to create the Figure and
Axes.</p>
<p>Below, we use this function to create a Figure that is 10 inches wide by
6 inches tall and filled with a one by two grid of Axes objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig2</span><span class="p">,</span> <span class="n">axs2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;type(fig2): &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">fig2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;type(axs): &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">axs2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axs2.shape: &quot;</span><span class="p">,</span> <span class="n">axs2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type(fig2):  &lt;class &#39;matplotlib.figure.Figure&#39;&gt;
type(axs):  &lt;class &#39;numpy.ndarray&#39;&gt;
axs2.shape:  (2,)
</pre></div>
</div>
<img alt="../../_images/7f2ea3ff037b3535734d54fcb4f71a05d3e6bbd1fae9ba4331309339c5dd1a83.png" src="../../_images/7f2ea3ff037b3535734d54fcb4f71a05d3e6bbd1fae9ba4331309339c5dd1a83.png" />
</div>
</div>
<p>We can plot from our DataFrame directly on our Axes objects by setting
the <code class="docutils literal notranslate"><span class="pre">ax</span></code> argument when calling <code class="docutils literal notranslate"><span class="pre">.plot</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aapl</span><span class="p">[[</span><span class="s2">&quot;Adj. Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Adj. High&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">aapl</span><span class="p">[[</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a2d905f58b16fdb7de87eec173907295617a55dfa23ad4f73aa7a698a4a53e21.png" src="../../_images/a2d905f58b16fdb7de87eec173907295617a55dfa23ad4f73aa7a698a4a53e21.png" />
</div>
</div>
<p><a id='exercise-1'></a></p>
<blockquote>
<div><p>See exercise 2 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p><a id='exercise-2'></a></p>
<blockquote>
<div><p>See exercise 3 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
</section>
<section id="data-cleaning">
<h2><span class="section-number">5.9.6. </span>Data Cleaning<a class="headerlink" href="#data-cleaning" title="Permalink to this heading">#</a></h2>
<p>Let’s continue on our path to recreating the Financial Times
visualization from above.</p>
<p>Before we can actually make the plot, we first have to clean the data.</p>
<p>Looking at our goal, we will need share price three days before and
after each announcement.</p>
<p>We will also need to normalize the share price to be 100 on the day of
the announcement and scale the neighboring days accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">CustomBusinessDay</span>

<span class="n">bday_us</span> <span class="o">=</span> <span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">neighbor_dates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">nbefore</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nafter</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Make sure the date is a datetime</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

    <span class="c1"># Create a list of business days</span>
    <span class="n">before_and_after</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">bday_us</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nbefore</span><span class="p">,</span> <span class="n">nafter</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">before_and_after</span>


<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ann_date</span> <span class="ow">in</span> <span class="n">announcement_dates</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">neighbor_dates</span><span class="p">(</span><span class="n">ann_date</span><span class="p">))</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>

<span class="c1"># Index into our DataFrame using the new dates</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">aapl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates</span><span class="p">]</span>
<span class="n">prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Ex-Dividend</th>
      <th>Split Ratio</th>
      <th>Adj. Open</th>
      <th>Adj. High</th>
      <th>Adj. Low</th>
      <th>Adj. Close</th>
      <th>Adj. Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-04</th>
      <td>84.05</td>
      <td>85.95</td>
      <td>83.82</td>
      <td>85.66</td>
      <td>30259300.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10.801596</td>
      <td>11.045773</td>
      <td>10.772038</td>
      <td>11.008504</td>
      <td>211815100.0</td>
    </tr>
    <tr>
      <th>2007-01-05</th>
      <td>85.77</td>
      <td>86.20</td>
      <td>84.40</td>
      <td>85.05</td>
      <td>29812200.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>11.022640</td>
      <td>11.077901</td>
      <td>10.846576</td>
      <td>10.930110</td>
      <td>208685400.0</td>
    </tr>
    <tr>
      <th>2007-01-08</th>
      <td>85.96</td>
      <td>86.53</td>
      <td>85.28</td>
      <td>85.47</td>
      <td>28468100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>11.047058</td>
      <td>11.120311</td>
      <td>10.959669</td>
      <td>10.984086</td>
      <td>199276700.0</td>
    </tr>
    <tr>
      <th>2007-01-09</th>
      <td>86.45</td>
      <td>92.98</td>
      <td>85.15</td>
      <td>92.57</td>
      <td>119617800.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>11.110030</td>
      <td>11.949226</td>
      <td>10.942962</td>
      <td>11.896535</td>
      <td>837324600.0</td>
    </tr>
    <tr>
      <th>2007-01-10</th>
      <td>94.75</td>
      <td>97.80</td>
      <td>93.45</td>
      <td>97.00</td>
      <td>105460000.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>12.176696</td>
      <td>12.568663</td>
      <td>12.009627</td>
      <td>12.465852</td>
      <td>738220000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We now want to bring information on iPhone models into the DataFrame.</p>
<p>We do this by:</p>
<ul class="simple">
<li><p>Joining on the announcement date. This will introduce a new column
named <code class="docutils literal notranslate"><span class="pre">Model</span></code> which has a value in the announcement date but has 3
<code class="docutils literal notranslate"><span class="pre">NaN</span></code> above and below each announcement date (a total of 66
<code class="docutils literal notranslate"><span class="pre">NaN</span></code>)</p></li>
<li><p>Using the methods <code class="docutils literal notranslate"><span class="pre">ffill</span></code> and <code class="docutils literal notranslate"><span class="pre">bfill</span></code>, we can replace these
<code class="docutils literal notranslate"><span class="pre">NaN</span></code>s with the corresponding model names.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prices.ffill(limit=3)</span></code> will fill the three days <em>after</em> the
announcement with the model name (down to 33 Nan)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prices.bfill(limit=3)</span></code> will fill the three days <em>before</em> the
announcement with the model name (no more <code class="docutils literal notranslate"><span class="pre">NaN</span></code>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prices</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">announcement_dates</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>66
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
2007-01-04             NaN
2007-01-05             NaN
2007-01-08             NaN
2007-01-09    First iPhone
2007-01-10             NaN
2007-01-11             NaN
2007-01-12             NaN
Name: Model, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prices</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>33
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
2007-01-04             NaN
2007-01-05             NaN
2007-01-08             NaN
2007-01-09    First iPhone
2007-01-10    First iPhone
2007-01-11    First iPhone
2007-01-12    First iPhone
Name: Model, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prices</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">bfill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">prices</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
2007-01-04    First iPhone
2007-01-05    First iPhone
2007-01-08    First iPhone
2007-01-09    First iPhone
2007-01-10    First iPhone
2007-01-11    First iPhone
2007-01-12    First iPhone
Name: Model, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Success!</p>
<p>Now for the second part of the cleaning: normalize the share price on
each announcement date to 100 and scale all neighbors accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale_by_middle</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># How many rows</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Divide by middle row and scale to 100</span>
    <span class="c1"># Note: N // 2 is modulus division meaning that it is</span>
    <span class="c1">#       rounded to nearest whole number)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Open&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">][</span><span class="s2">&quot;Open&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># We don&#39;t want to keep actual dates, but rather the number</span>
    <span class="c1"># of days before or after the announcment. Let&#39;s set that</span>
    <span class="c1"># as the index. Note the +1 because range excludes upper limit</span>
    <span class="n">out</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># also change the name of this series</span>
    <span class="n">out</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DeltaDays&quot;</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_plot</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scale_by_middle</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">to_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Model</th>
      <th>3G</th>
      <th>3GS</th>
      <th>4</th>
      <th>4S</th>
      <th>5</th>
      <th>5S/5C</th>
      <th>6/6 Plus</th>
      <th>6S/6S Plus</th>
      <th>7/7 Plus</th>
      <th>8/8 Plus/X</th>
      <th>First iPhone</th>
    </tr>
    <tr>
      <th>DeltaDays</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-3</th>
      <td>99.502488</td>
      <td>97.343902</td>
      <td>97.053874</td>
      <td>107.301706</td>
      <td>101.679538</td>
      <td>98.824575</td>
      <td>99.767864</td>
      <td>98.883615</td>
      <td>98.432718</td>
      <td>99.680216</td>
      <td>97.223829</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>100.719230</td>
      <td>97.434293</td>
      <td>96.842380</td>
      <td>103.350509</td>
      <td>102.039439</td>
      <td>98.467009</td>
      <td>99.717400</td>
      <td>95.789381</td>
      <td>99.879440</td>
      <td>98.923805</td>
      <td>99.213418</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>101.665585</td>
      <td>101.036017</td>
      <td>98.245767</td>
      <td>101.548442</td>
      <td>99.739072</td>
      <td>99.762940</td>
      <td>100.222043</td>
      <td>98.145218</td>
      <td>100.064917</td>
      <td>98.702417</td>
      <td>99.433198</td>
    </tr>
    <tr>
      <th>0</th>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>97.517846</td>
      <td>99.993047</td>
      <td>99.527372</td>
      <td>98.208613</td>
      <td>101.577566</td>
      <td>92.258021</td>
      <td>98.920065</td>
      <td>96.932138</td>
      <td>99.462116</td>
      <td>98.314987</td>
      <td>109.600925</td>
    </tr>
    <tr>
      <th>2</th>
      <td>99.686351</td>
      <td>98.929217</td>
      <td>100.081188</td>
      <td>99.668954</td>
      <td>103.464797</td>
      <td>92.552351</td>
      <td>101.342350</td>
      <td>98.268284</td>
      <td>97.041640</td>
      <td>97.773815</td>
      <td>110.977444</td>
    </tr>
    <tr>
      <th>3</th>
      <td>98.123513</td>
      <td>97.031011</td>
      <td>100.292855</td>
      <td>100.323037</td>
      <td>104.873660</td>
      <td>92.718333</td>
      <td>102.149778</td>
      <td>102.478903</td>
      <td>95.196142</td>
      <td>97.454031</td>
      <td>109.415847</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Re-order the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_plot</span> <span class="o">=</span> <span class="n">to_plot</span><span class="p">[</span><span class="n">announcement_dates</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">to_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Model</th>
      <th>First iPhone</th>
      <th>3G</th>
      <th>3GS</th>
      <th>4</th>
      <th>4S</th>
      <th>5</th>
      <th>5S/5C</th>
      <th>6/6 Plus</th>
      <th>6S/6S Plus</th>
      <th>7/7 Plus</th>
      <th>8/8 Plus/X</th>
    </tr>
    <tr>
      <th>DeltaDays</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-3</th>
      <td>97.223829</td>
      <td>99.502488</td>
      <td>97.343902</td>
      <td>97.053874</td>
      <td>107.301706</td>
      <td>101.679538</td>
      <td>98.824575</td>
      <td>99.767864</td>
      <td>98.883615</td>
      <td>98.432718</td>
      <td>99.680216</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>99.213418</td>
      <td>100.719230</td>
      <td>97.434293</td>
      <td>96.842380</td>
      <td>103.350509</td>
      <td>102.039439</td>
      <td>98.467009</td>
      <td>99.717400</td>
      <td>95.789381</td>
      <td>99.879440</td>
      <td>98.923805</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>99.433198</td>
      <td>101.665585</td>
      <td>101.036017</td>
      <td>98.245767</td>
      <td>101.548442</td>
      <td>99.739072</td>
      <td>99.762940</td>
      <td>100.222043</td>
      <td>98.145218</td>
      <td>100.064917</td>
      <td>98.702417</td>
    </tr>
    <tr>
      <th>0</th>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>109.600925</td>
      <td>97.517846</td>
      <td>99.993047</td>
      <td>99.527372</td>
      <td>98.208613</td>
      <td>101.577566</td>
      <td>92.258021</td>
      <td>98.920065</td>
      <td>96.932138</td>
      <td>99.462116</td>
      <td>98.314987</td>
    </tr>
    <tr>
      <th>2</th>
      <td>110.977444</td>
      <td>99.686351</td>
      <td>98.929217</td>
      <td>100.081188</td>
      <td>99.668954</td>
      <td>103.464797</td>
      <td>92.552351</td>
      <td>101.342350</td>
      <td>98.268284</td>
      <td>97.041640</td>
      <td>97.773815</td>
    </tr>
    <tr>
      <th>3</th>
      <td>109.415847</td>
      <td>98.123513</td>
      <td>97.031011</td>
      <td>100.292855</td>
      <td>100.323037</td>
      <td>104.873660</td>
      <td>92.718333</td>
      <td>102.149778</td>
      <td>102.478903</td>
      <td>95.196142</td>
      <td>97.454031</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="constructing-the-plot">
<h2><span class="section-number">5.9.7. </span>Constructing the Plot<a class="headerlink" href="#constructing-the-plot" title="Permalink to this heading">#</a></h2>
<p>Now that we have cleaned up the data, let’s construct the plot.</p>
<p>We do this by using the DataFrame <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method and then using the
matplotlib methods and functions to fine tune our plot, changing one
feature or set of features at a time.</p>
<p>To prepare our use of the plot method, we will need to set up some data
for what color each line should be, as well as where to draw the tick
marks on the vertical axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># colors</span>
<span class="n">background</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">253</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">222</span><span class="p">])</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">blue</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">134</span><span class="p">])</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">pink</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">232</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">126</span><span class="p">])</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pink</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blue</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">announcement_dates</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_color</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># yticks</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">115</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Below, we construct the basic plot using <code class="docutils literal notranslate"><span class="pre">to_plot.plot</span></code>.</p>
<p>Notice that we have specified a few options as keyword arguments to our
function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct figure and Axes objects</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># We can pass our array of Axes and `subplots=True`</span>
<span class="c1"># because we have one Axes per column</span>
<span class="n">to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fb112d77a18796a744cbbcb166fb6616ec94a975db389bf88c69d411d3b756c4.png" src="../../_images/fb112d77a18796a744cbbcb166fb6616ec94a975db389bf88c69d411d3b756c4.png" />
</div>
</div>
<p><a id='exercise-3'></a></p>
<blockquote>
<div><p>See exercise 4 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<section id="subplot-spacing-fig-tight-layout">
<h3><span class="section-number">5.9.7.1. </span>Subplot Spacing: <code class="docutils literal notranslate"><span class="pre">fig.tight_layout</span></code><a class="headerlink" href="#subplot-spacing-fig-tight-layout" title="Permalink to this heading">#</a></h3>
<p>That figure has the basic lines we are after, but is quite ugly when
compared to the FT figure we are trying to produce.</p>
<p>Let’s refine the plot one step at a time.</p>
<p>First, notice how the <code class="docutils literal notranslate"><span class="pre">-3</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code> labels are running into each
other?</p>
<p>This commonly happens in figures with many subplots.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">fig.tight_layout()</span></code> will fix these problems – as well
as most other subplot spacing issues.</p>
<p>We <em>almost always</em> call this method when building a plot with multiple
subplots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add some spacing around subplots</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2a7a42a67a3df0fd55d0b39a99bb8ac02736612ad8d1dfcbd39b23458eee0140.png" src="../../_images/2a7a42a67a3df0fd55d0b39a99bb8ac02736612ad8d1dfcbd39b23458eee0140.png" />
</div>
</div>
</section>
<section id="properties-of-the-figure">
<h3><span class="section-number">5.9.7.2. </span>Properties of the Figure<a class="headerlink" href="#properties-of-the-figure" title="Permalink to this heading">#</a></h3>
<p>Now, let’s make the background of our figure match the background of the
FT post.</p>
<p>To do this, we will use the <code class="docutils literal notranslate"><span class="pre">fig.set_facecolor</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set background color</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">background</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/47a3d043b2f56a25fea7bc49a83979b9953bef38a106c2297ceec0e0ea0d515f.png" src="../../_images/47a3d043b2f56a25fea7bc49a83979b9953bef38a106c2297ceec0e0ea0d515f.png" />
</div>
</div>
</section>
<section id="properties-of-an-axes">
<h3><span class="section-number">5.9.7.3. </span>Properties of an <code class="docutils literal notranslate"><span class="pre">Axes</span></code><a class="headerlink" href="#properties-of-an-axes" title="Permalink to this heading">#</a></h3>
<p>Notice that this worked for the figure as a whole, but not for any of
the Axes.</p>
<p>To fix this, we will need to call <code class="docutils literal notranslate"><span class="pre">.set_facecolor</span></code> on each Axes.</p>
<p>While we are doing that, let’s fix up a number of other things about the
Axes:</p>
<ul class="simple">
<li><p>Add Axes titles</p></li>
<li><p>Remove the x axis titles</p></li>
<li><p>Remove tick marks on y axis</p></li>
<li><p>Add a “faint” version of the line from the first subplot</p></li>
<li><p>Remove x axis tick labels</p></li>
<li><p>Make x axis ticks longer and semi-transparent</p></li>
<li><p>Make sure all Axes have same y limits</p></li>
<li><p>Remove the spines (the border on each Axes)</p></li>
<li><p>Add a white circle to (0, 100) on each Axes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each Axes... do the following</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">announcement_dates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># add faint blue line representing impact of original iPhone announcement</span>
    <span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;First iPhone&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># add a title</span>
    <span class="n">ti</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">announcement_dates</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">announcement_dates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>

    <span class="c1"># set background color of plotting area</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">background</span><span class="p">)</span>

    <span class="c1"># remove xlabels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># turn of tick marks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># make x ticks longer and semi-transparent</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>

    <span class="c1"># set limits on vertical axis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># add a white circle at 0, 100</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># remove border around each subplot</span>
    <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/62460533cb06b9480b37abe307cb183e0c585fb1b1aad8f0d5365857c285f02f.png" src="../../_images/62460533cb06b9480b37abe307cb183e0c585fb1b1aad8f0d5365857c285f02f.png" />
</div>
</div>
<p><a id='exercise-4'></a></p>
<blockquote>
<div><p>See exercise 5 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>Let’s continue and add tick labels to the right of the far right
Axes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add tick labels to right of iPhone 8/X announcement</span>
<span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f9f9de6bed454358aeb95a268f0934fe4999a1772d02deb4ee5da23d849ebac2.png" src="../../_images/f9f9de6bed454358aeb95a268f0934fe4999a1772d02deb4ee5da23d849ebac2.png" />
</div>
</div>
<p>We can also add tick labels for the x-axis ticks on the 1st and 6th
plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;3 days</span><span class="se">\n</span><span class="s2">before&quot;</span><span class="p">,</span> <span class="s2">&quot;3 days</span><span class="se">\n</span><span class="s2">after&quot;</span><span class="p">])</span>

    <span class="c1"># need to make these tick labels centered at tick,</span>
    <span class="c1"># instead of the default of right aligned</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_horizontalalignment</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d51cbc557c6473e7a421d11352914abe7a51b5572d8dd3e13a602348df21e319.png" src="../../_images/d51cbc557c6473e7a421d11352914abe7a51b5572d8dd3e13a602348df21e319.png" />
</div>
</div>
</section>
<section id="transforms-and-lines">
<h3><span class="section-number">5.9.7.4. </span>Transforms and Lines<a class="headerlink" href="#transforms-and-lines" title="Permalink to this heading">#</a></h3>
<p>Now we would like to add a horizontal line that lines up with each
vertical tick label (the numbers from 90 to 115) and runs across the
entire figure.</p>
<p>This is actually harder than it sounds because most of the “drawing”
capabilities of matplotlib are built around drawing on a single Axes and
we want to draw across 11 of them.</p>
<p>However, as we promised above, anything <em>is</em> possible and we will show
you how to do it.</p>
<p>When matplotlib draws any data – be it a line, circle, rectangle, or
other – it must know what <em>coordinate system</em> to use.</p>
<p>We typically think about drawing things in the <em>data’s</em> coordinate
system (remember above how we added a white circle at (0, 100)).</p>
<p>However, we might also want to draw using two other coordinate systems:</p>
<ul class="simple">
<li><p>Figure: the bottom left of the figure is (0, 0) and top right is (1,
1)</p></li>
<li><p>Axes: The bottom left of an Axes is (0, 0) and top right is (1, 1)</p></li>
</ul>
<p>For our application, we would like to use the figure’s coordinate system
in the <code class="docutils literal notranslate"><span class="pre">x</span></code> dimension (going across the plot), but the data’s
coordinate system in the <code class="docutils literal notranslate"><span class="pre">y</span></code> dimension (so we make sure to put the
lines at each of our <code class="docutils literal notranslate"><span class="pre">yticks</span></code>).</p>
<p>Luckily for us, matplotlib provides a way to use <em>exactly</em> that coordinate
system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a transform that...</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">blended_transform_factory</span><span class="p">(</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span>  <span class="c1"># goes across whole figure in x direction</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span>  <span class="c1"># goes up with the y data in the first axis</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">trans</span></code> to draw lines where the <code class="docutils literal notranslate"><span class="pre">x</span></code> values will map
from (0, 1) in the Figure coordinates and the <code class="docutils literal notranslate"><span class="pre">y</span></code> values will go from
(90, 115) on the data coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
        <span class="c1"># x values found by trial and error</span>
        <span class="p">[</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.985</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/614a6fe10973b0dcf5f555f2fa1698ec6cb40a76b943cce2f1a7898957486591.png" src="../../_images/614a6fe10973b0dcf5f555f2fa1698ec6cb40a76b943cce2f1a7898957486591.png" />
</div>
</div>
<p>Now, we need to a add vertical line from the (0, 90) to (0, 100) on the
first axis so we can label the center of each line as the announcement
date.</p>
<p>We will split this line in two to leave room for the text <code class="docutils literal notranslate"><span class="pre">Announced</span></code>
to be added soon.</p>
<p>To add the lines, we will use the data coordinate system from the first
Axes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">([</span><span class="mi">90</span><span class="p">,</span> <span class="mf">91.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">93</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/adfe8a8af8edb4d49ea0be15c1a6fa1c42defdc9c793f4b585c713035557cca7.png" src="../../_images/adfe8a8af8edb4d49ea0be15c1a6fa1c42defdc9c793f4b585c713035557cca7.png" />
</div>
</div>
</section>
<section id="annotations">
<h3><span class="section-number">5.9.7.5. </span>Annotations<a class="headerlink" href="#annotations" title="Permalink to this heading">#</a></h3>
<p>The last step on our journey is to add annotations that mark Tim Cook’s
first announcement as CEO, the lackluster market response to <code class="docutils literal notranslate"><span class="pre">S</span></code> model
announcements, and a label showing that the white dot on each subplot is
associated with the announcement date.</p>
<p>Adding text to figures is always a bit verbose, so don’t get too scared
by what is happening here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="s2">&quot;Tim Cook&#39;s first iPhone</span><span class="se">\n</span><span class="s2">announcement as Apple&#39;s CEO&quot;</span><span class="p">,</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">93</span><span class="p">),</span>
    <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;arrowstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;connectionstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;angle3,angleA=0,angleB=110&quot;</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span>
    <span class="p">},</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/148dec9e3d79b07c9c2689fb115b77f4ad5e2da229e9287cdde86d1434576b87.png" src="../../_images/148dec9e3d79b07c9c2689fb115b77f4ad5e2da229e9287cdde86d1434576b87.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
    <span class="n">ann</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="s2">&quot;Hardware upgrade &#39;S&#39; models</span><span class="se">\n</span><span class="s2">underwhelm the market&quot;</span><span class="p">,</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">92</span><span class="p">),</span>
    <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;semibold&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">pink</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/939474d4c9f81d2a7ab0d3f62c7cb1c74f46f52b9c40bd818278dfaa0dc523e6.png" src="../../_images/939474d4c9f81d2a7ab0d3f62c7cb1c74f46f52b9c40bd818278dfaa0dc523e6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="s2">&quot;Announced&quot;</span><span class="p">,</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">92</span><span class="p">),</span>
    <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/08db34e6e72c83c1d1ea6fa1e350ef4479ac543c011e687e11671763ded38422.png" src="../../_images/08db34e6e72c83c1d1ea6fa1e350ef4479ac543c011e687e11671763ded38422.png" />
</div>
</div>
</section>
</section>
<section id="saving-the-figure">
<h2><span class="section-number">5.9.8. </span>Saving the Figure<a class="headerlink" href="#saving-the-figure" title="Permalink to this heading">#</a></h2>
<p>Now that we have a finished product we are happy with, let’s save it to
a file on our computer using the <code class="docutils literal notranslate"><span class="pre">fig.savefig</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;aapl_iPhone_annoucements.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we asked matplotlib to save our figure in the <code class="docutils literal notranslate"><span class="pre">png</span></code> format, with
400 dots per inch (<code class="docutils literal notranslate"><span class="pre">dpi</span></code>, meaning each inch has a 400 by 400 set of
colored points).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">bbox_inches</span></code> command is needed here to make sure pandas doesn’t
chop off any of our Axes titles or tick labels.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">facecolor</span></code> argument was necessary because matplotlib
will save figures with a transparent background by default (meaning the background
is see-through so it “adopts” the background color of whatever website,
document, or presentation is is placed in).</p>
<p>We could have chosen a different file format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;aapl_iPhone_annoucements.jpeg&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>

<span class="c1"># dpi not needed as pdf is a &quot;vector&quot; format that effectively has an infinite dpi</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;aapl_iPhone_annoucements.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>

<span class="c1"># svg is also a vector format</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;aapl_iPhone_annoucements.svg&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="summary">
<h3><span class="section-number">5.9.8.1. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h3>
<p>Phew, we made it!</p>
<p>We ended up writing quite a bit of code to get the figure to look
<em>exactly</em> how we wanted it to look.</p>
<p>Typically, our plotting code will be much more concise and simple
because we don’t usually require the same standards for aesthetic
properties as professional journalists do.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">5.9.9. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p><a id='exerciselist-0'></a>
<strong>Exercise 1</strong></p>
<p><strong>Exercise:</strong> Using the <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method, plot the opening share price
for Apple’s stock.</p>
<p>What <code class="docutils literal notranslate"><span class="pre">type</span></code> of object is returned from that method?</p>
<p>What methods does this object have?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make plot here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># explore methods here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 2</strong></p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">plt.subplots</span></code> function, make a Figure with a two-by-one
grid of subplots (two rows, one column).</p>
<p>On the upper Axes, plot the adjusted close price.</p>
<p>On the lower one, plot the adjusted volume as an area chart (search for
an argument on the <code class="docutils literal notranslate"><span class="pre">plot</span></code> method to change the kind of plot).</p>
<p>Google for how to set a title for a <code class="docutils literal notranslate"><span class="pre">Figure</span></code> object and then do so.</p>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 3</strong></p>
<p>Take 5 minutes to explore the different arguments to the DataFrame <code class="docutils literal notranslate"><span class="pre">.plot</span></code>
method. Try to make a plot that is both good looking and interesting (
we know, those are subjective, but do your best!).</p>
<p>Some arguments you might consider exploring are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sharex</span></code> or <code class="docutils literal notranslate"><span class="pre">sharey</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">style</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">color</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kind</span></code></p></li>
</ul>
<p>Hint: You can browse the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/visualization.html">official pandas plotting
documentation</a>
for inspiration.</p>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 4</strong></p>
<p>Think about  what each of the argument we passed to <code class="docutils literal notranslate"><span class="pre">.plot</span></code> does.</p>
<p>For some you might be able to guess, for others you will need to look at
the documentation.</p>
<p>For your reference, record your findings in a markdown cell below.</p>
<p>Hint: Use <code class="docutils literal notranslate"><span class="pre">to_plot.plot?</span></code> to pull up the docs.</p>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 5</strong></p>
<p>For each operation in the list below (copied from above), make a note
of which functions/methods were called to achieve the result.
Edit the markdown cell containing the list directly.</p>
<p>Note: This might seem redundant since the comments above give the answers,
but forcing yourself to write out the names of the functions will help
you remember them when you need them later on.</p>
<ul class="simple">
<li><p>Change background color</p></li>
<li><p>Add Axes titles</p></li>
<li><p>Remove the x axis titles</p></li>
<li><p>Remove tick marks on y axis</p></li>
<li><p>Add a “faint” version of the line from the first subplot</p></li>
<li><p>Remove x axis tick labels</p></li>
<li><p>Make x axis ticks longer and semi-transparent</p></li>
<li><p>Make sure all Axes have same y limits</p></li>
<li><p>Remove the spines (the border on each Axes)</p></li>
<li><p>Add a white circle to (0, 100) on each Axes</p></li>
</ul>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="groupby.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.8. </span>GroupBy (opt)</p>
      </div>
    </a>
    <a class="right-next"
       href="storage_formats.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.10. </span>Storage Formats (opt)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.9.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">5.9.2. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-want-operator-replicate-a-professional-figure">5.9.3. The Want Operator: Replicate a Professional Figure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">5.9.4. Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#warmup">5.9.5. Warmup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">5.9.6. Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-plot">5.9.7. Constructing the Plot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subplot-spacing-fig-tight-layout">5.9.7.1. Subplot Spacing: <code class="docutils literal notranslate"><span class="pre">fig.tight_layout</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-figure">5.9.7.2. Properties of the Figure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-an-axes">5.9.7.3. Properties of an <code class="docutils literal notranslate"><span class="pre">Axes</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-and-lines">5.9.7.4. Transforms and Lines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annotations">5.9.7.5. Annotations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-figure">5.9.8. Saving the Figure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5.9.8.1. Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.9.9. Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>