

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.8. GroupBy (opt) &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/pandas/groupby';</script>
    <link rel="canonical" href="https://amoreira2.github.io/quantitativeinvesting/chapters/pandas/groupby.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.9. Intermediate Plotting (opt)" href="matplotlib.html" />
    <link rel="prev" title="5.7. Merge (opt)" href="merge.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03/programming-in-python.html">3. First Steps with Python</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/essentials.html">4. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">4.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">4.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">4.3. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">4.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy1.html">4.5. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting1.html">4.6. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="workingwithdata.html">5. Working with Data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html">5.2. Pandas Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_index.html">5.3. Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html">5.4. Time-Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_clean.html">5.5. Cleaning data (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshape.html">5.6. Reshape (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="merge.html">5.7. Merge (opt)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.8. Group-by (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="matplotlib.html">5.9. Plotting (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage_formats.html">5.10. Data Storage (opt)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Returns.html">6. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Returns1.html">6.1. Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">6.2. Modeling randomness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TheChoiceofFrequency.html">6.3. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.4. Linear algebra Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/UsingAPI.html">6.5. Data APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/PortfolioMath.html">7. Portfolio Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/CapitalAllocationLine.html">8. Capital Allocation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/meanvariance1.html">9. Mean Variance Frontier</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MeanVariance.html">9.1. Mean Variance Efficient Portfolios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/CaseStudy.html">9.2. Case Study in International Diversification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/LeverageandShorting.html">9.3. Leverage and Shorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Portfoliooptimizationwithconstraints.html">9.4. Portfolio Optimization with constraints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/EstimationUncertainty.html">10. Estimation Uncertainty and It's Implications for investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/TradingStrategies.html">11. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Timing.html">12. Timing Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Volatilitytiming.html">12.1. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/crosssectionalequitystrategies.html">13. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Valueinvesting.html">13.1. Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Momentum.html">13.2. Momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/OtherEquityStrategies.html">13.3. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Evaluation.html">14. Evaluating a Trading Strategy</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Econometrics.html">14.1. The Econometrics of Strategy Evalaution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/outofsample.html">14.2. Out of Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TailandBackground.html">14.3. Tail Risks and Background Risks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MultiFactorModels.html">14.4. Multifactor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Topics.html">15. Topics in Quantitative Investing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Equilbrium.html">15.1. Intepreting Factor models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Implementation.html">15.2. Strategy Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Horizon.html">15.3. Investment horizon effects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">16. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">17. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">17.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">17.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">17.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">17.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">17.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">17.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">17.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">17.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Lectures/blob/main/chapters/pandas/groupby.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures/issues/new?title=Issue%20on%20page%20%2Fchapters/pandas/groupby.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/pandas/groupby.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>GroupBy (opt)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.8.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-apply-combine">5.8.2. Split-Apply-Combine</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-example">5.8.2.1. Simple Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-aggregate-functions">5.8.2.2. Custom Aggregate Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-the-apply-method">5.8.2.3. Transforms: The <code class="docutils literal notranslate"><span class="pre">apply</span></code> Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-grouper">5.8.2.4. <code class="docutils literal notranslate"><span class="pre">pd.Grouper</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-airline-delays">5.8.3. Case Study: Airline Delays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-cohort-analysis-using-shopify-data">5.8.4. Exercise: Cohort Analysis using Shopify Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-exercise">5.8.4.1. Extended Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.8.5. Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="groupby-opt">
<h1><span class="section-number">5.8. </span>GroupBy (opt)<a class="headerlink" href="#groupby-opt" title="Permalink to this heading">#</a></h1>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p><span class="xref myst">Functions</span></p></li>
<li><p>pandas introduction <a class="reference internal" href="intro.html"><span class="doc std std-doc">1</span></a> and <a class="reference internal" href="basics.html"><span class="doc std std-doc">2</span></a></p></li>
<li><p><a class="reference internal" href="reshape.html"><span class="doc std std-doc">Reshape</span></a></p></li>
</ul>
<p><strong>Outcomes</strong></p>
<ul class="simple">
<li><p>Understand the split-apply-combine strategy for aggregate
computations on groups of data</p></li>
<li><p>Be able use basic aggregation methods on <code class="docutils literal notranslate"><span class="pre">df.groupby</span></code> to compute
within group statistics</p></li>
<li><p>Understand how to group by multiple keys at once</p></li>
</ul>
<p><strong>Data</strong></p>
<ul class="simple">
<li><p>Details for all delayed US domestic flights in December 2016,
obtained from the <a class="reference external" href="https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&amp;DB_Short_Name=On-Time">Bureau of Transportation
Statistics</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment following line to install on colab</span>
<span class="c1">#! pip install qeds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># activate plot theme</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="n">qeds</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">mpl_style</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<section id="outline">
<h2><span class="section-number">5.8.1. </span>Outline<a class="headerlink" href="#outline" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><span class="xref myst">GroupBy</span></p>
<ul>
<li><p><span class="xref myst">Split-Apply-Combine</span></p></li>
<li><p><span class="xref myst">Case Study: Airline Delays</span></p></li>
<li><p><span class="xref myst">Exercise: Cohort Analysis using Shopify Data</span></p></li>
<li><p><span class="xref myst">Exercises</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="split-apply-combine">
<h2><span class="section-number">5.8.2. </span>Split-Apply-Combine<a class="headerlink" href="#split-apply-combine" title="Permalink to this heading">#</a></h2>
<p>One powerful paradigm for analyzing data is the “Split-Apply-Combine”
strategy.</p>
<p>This strategy has three steps:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Split</span></code>: split the data into groups based on values in one or more columns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Apply</span></code>: apply a function or routine to each group separately.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Combine</span></code>: combine the output of the apply step into a DataFrame,
using the group identifiers as the index.</p></li>
</ol>
<p>We will cover the main components in this lecture, but we encourage you
to also study the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/groupby.html">official
documentation</a>
to learn more about what is possible.</p>
<p>To describe the concepts, we will need some data.</p>
<p>We will begin with a simple made-up dataset to discuss the concepts and
then work through extended example and exercises with real data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">C</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;A&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="s2">&quot;B&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="simple-example">
<h3><span class="section-number">5.8.2.1. </span>Simple Example<a class="headerlink" href="#simple-example" title="Permalink to this heading">#</a></h3>
<p>To perform the <em>Split</em> step, we call the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> method on our
DataFrame.</p>
<p>The first argument to <code class="docutils literal notranslate"><span class="pre">groupby</span></code> is a description of how we want to
construct groups.</p>
<p>In the most basic version, we will pass a string identifying the column
name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> of variable we get back is a <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code>, which we
will sometimes refer to as GroupBy for short.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">gbA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.groupby.generic.DataFrameGroupBy
</pre></div>
</div>
</div>
</div>
<p>Looking at the “groups” inside of the GroupBy object can help us
understand what the GroupBy represents.</p>
<p>We can do this with the <code class="docutils literal notranslate"><span class="pre">gb.get_group(group_name)</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can <em>apply</em> some of our favorite aggregation functions directly on the
<code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object.</p>
<p><a id='exercise-0'></a></p>
<blockquote>
<div><p>See exercise 1 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p><a id='exercise-1'></a></p>
<blockquote>
<div><p>See exercise 2 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>If we pass a list of strings to <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, it will group based on
unique combinations of values from all columns in the list.</p>
<p>Let’s see an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbAB</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="nb">type</span><span class="p">(</span><span class="n">gbAB</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.groupby.generic.DataFrameGroupBy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbAB</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice that we still have a GroupBy object, so we can apply our favorite
aggregations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbAB</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>C</th>
    </tr>
    <tr>
      <th>A</th>
      <th>B</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>1</th>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>1</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice that the output is a DataFrame with two levels on the index
and a single column <code class="docutils literal notranslate"><span class="pre">C</span></code>. (Quiz: how do we know it is a DataFrame with
one column and not a Series?)</p>
<p>This highlights a principle of how pandas handles the <em>Combine</em> part of
the strategy:</p>
<blockquote>
<div><p>The index of the combined DataFrame will be the group identifiers,
with one index level per group key.</p>
</div></blockquote>
</section>
<section id="custom-aggregate-functions">
<h3><span class="section-number">5.8.2.2. </span>Custom Aggregate Functions<a class="headerlink" href="#custom-aggregate-functions" title="Permalink to this heading">#</a></h3>
<p>So far, we have been applying built-in aggregations to our GroupBy object.</p>
<p>We can also apply custom aggregations to each group of a GroupBy in two
steps:</p>
<ol class="arabic simple">
<li><p>Write our custom aggregation as a Python function.</p></li>
<li><p>Passing our function as an argument to the <code class="docutils literal notranslate"><span class="pre">.agg</span></code> method of a GroupBy.</p></li>
</ol>
<p>Let’s see an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">num_missing</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s2">&quot;Return the number of missing items in each column of df&quot;</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can call this function on our original DataFrame to get the number of
missing items in each column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_missing</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    0
B    0
C    2
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We can also apply it to a GroupBy object to get the number of missing
items in each column <em>for each group</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">num_missing</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The key to keep in mind is that the function we pass to <code class="docutils literal notranslate"><span class="pre">agg</span></code> should
take in a DataFrame (or Series) and return a Series (or single value)
with one item per column in the original DataFrame.</p>
<p>When the function is called, the data for each group will be passed to
our function as a DataFrame (or Series).</p>
</section>
<section id="transforms-the-apply-method">
<h3><span class="section-number">5.8.2.3. </span>Transforms: The <code class="docutils literal notranslate"><span class="pre">apply</span></code> Method<a class="headerlink" href="#transforms-the-apply-method" title="Permalink to this heading">#</a></h3>
<p>As we saw in the <a class="reference internal" href="basics.html"><span class="doc std std-doc">basics lecture</span></a>, we can apply transforms to DataFrames.</p>
<p>We can do the same with GroupBy objects using the <code class="docutils literal notranslate"><span class="pre">.apply</span></code> method.</p>
<p>Let’s see an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">smallest_by_b</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">smallest_by_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>4</th>
      <td>2</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice that the return value from applying our series transform to <code class="docutils literal notranslate"><span class="pre">gbA</span></code>
was the group key on the outer level (the <code class="docutils literal notranslate"><span class="pre">A</span></code> column) and the original
index from <code class="docutils literal notranslate"><span class="pre">df</span></code> on the inner level.</p>
<p>The original index came along because that was the index of the
DataFrame returned by <code class="docutils literal notranslate"><span class="pre">smallest_by_b</span></code>.</p>
<p>Had our function returned something other than the index from <code class="docutils literal notranslate"><span class="pre">df</span></code>,
that would appear in the result of the call to <code class="docutils literal notranslate"><span class="pre">.apply</span></code>.</p>
<p><a id='exercise-2'></a></p>
<blockquote>
<div><p>See exercise 3 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
</section>
<section id="pd-grouper">
<h3><span class="section-number">5.8.2.4. </span><code class="docutils literal notranslate"><span class="pre">pd.Grouper</span></code><a class="headerlink" href="#pd-grouper" title="Permalink to this heading">#</a></h3>
<p>Sometimes, in order to construct the groups you want, you need to give
pandas more information than just a column name.</p>
<p>Some examples are:</p>
<ul class="simple">
<li><p>Grouping by a column and a level of the index.</p></li>
<li><p>Grouping time series data at a particular frequency.</p></li>
</ul>
<p>pandas lets you do this through the <code class="docutils literal notranslate"><span class="pre">pd.Grouper</span></code> type.</p>
<p>To see it in action, let’s make a copy of <code class="docutils literal notranslate"><span class="pre">df</span></code> with <code class="docutils literal notranslate"><span class="pre">A</span></code> moved to the
index and a <code class="docutils literal notranslate"><span class="pre">Date</span></code> column added.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">),</span>
    <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;BQ&quot;</span><span class="p">,</span>
    <span class="n">periods</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>Date</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1.0</td>
      <td>2020-09-30</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2.0</td>
      <td>2020-12-31</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3.0</td>
      <td>2021-03-31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>NaN</td>
      <td>2021-06-30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>5.0</td>
      <td>2021-09-30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>NaN</td>
      <td>2021-12-31</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can group by year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-12-31</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2021-12-31</th>
      <td>4</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can group by the <code class="docutils literal notranslate"><span class="pre">A</span></code> level of the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>Date</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can combine these to group by both.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>Date</th>
      <th>A</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-12-31</th>
      <th>1</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2021-12-31</th>
      <th>1</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And we can combine <code class="docutils literal notranslate"><span class="pre">pd.Grouper</span></code> with a string, where the string
denotes a column name</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>C</th>
    </tr>
    <tr>
      <th>Date</th>
      <th>B</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-12-31</th>
      <th>1</th>
      <td>2</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2021-12-31</th>
      <th>1</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="case-study-airline-delays">
<h2><span class="section-number">5.8.3. </span>Case Study: Airline Delays<a class="headerlink" href="#case-study-airline-delays" title="Permalink to this heading">#</a></h2>
<p>Let’s apply our new split-apply-combine skills to the airline dataset we
saw in the <a class="reference internal" href="merge.html"><span class="doc std std-doc">merge</span></a> lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">air_dec</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;airline_performance_dec16&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we compute the average delay in arrival time for all carriers
each week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weekly_delays</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">air_dec</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">),</span> <span class="s2">&quot;Carrier&quot;</span><span class="p">])</span>
    <span class="p">[</span><span class="s2">&quot;ArrDelay&quot;</span><span class="p">]</span>               <span class="c1"># extract one column</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>                    <span class="c1"># take average</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;Carrier&quot;</span><span class="p">)</span>  <span class="c1"># Flip carrier up as column names</span>
<span class="p">)</span>
<span class="n">weekly_delays</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Carrier</th>
      <th>AA</th>
      <th>AS</th>
      <th>B6</th>
      <th>DL</th>
      <th>EV</th>
      <th>F9</th>
      <th>HA</th>
      <th>NK</th>
      <th>OO</th>
      <th>UA</th>
      <th>VX</th>
      <th>WN</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-12-04</th>
      <td>-1.714887</td>
      <td>2.724273</td>
      <td>-2.894269</td>
      <td>-5.088351</td>
      <td>8.655332</td>
      <td>-2.894212</td>
      <td>-0.558282</td>
      <td>5.468909</td>
      <td>2.749573</td>
      <td>5.564496</td>
      <td>-2.121821</td>
      <td>-1.663695</td>
    </tr>
    <tr>
      <th>2016-12-11</th>
      <td>1.148833</td>
      <td>12.052031</td>
      <td>5.795062</td>
      <td>2.507745</td>
      <td>13.220673</td>
      <td>4.578861</td>
      <td>2.054302</td>
      <td>8.713755</td>
      <td>15.429660</td>
      <td>4.094176</td>
      <td>12.080938</td>
      <td>1.865933</td>
    </tr>
    <tr>
      <th>2016-12-18</th>
      <td>16.357561</td>
      <td>7.643767</td>
      <td>34.608356</td>
      <td>18.000000</td>
      <td>23.876622</td>
      <td>45.014888</td>
      <td>9.388889</td>
      <td>22.857899</td>
      <td>30.901639</td>
      <td>22.398130</td>
      <td>33.651128</td>
      <td>18.373400</td>
    </tr>
    <tr>
      <th>2016-12-25</th>
      <td>6.364513</td>
      <td>2.719699</td>
      <td>5.586836</td>
      <td>-0.916113</td>
      <td>6.857143</td>
      <td>54.084959</td>
      <td>5.075747</td>
      <td>10.443369</td>
      <td>15.004780</td>
      <td>5.332474</td>
      <td>17.286917</td>
      <td>10.197685</td>
    </tr>
    <tr>
      <th>2017-01-01</th>
      <td>2.321836</td>
      <td>1.226662</td>
      <td>10.661577</td>
      <td>2.048116</td>
      <td>6.800898</td>
      <td>8.280298</td>
      <td>6.970016</td>
      <td>8.361123</td>
      <td>8.971083</td>
      <td>0.061786</td>
      <td>1.349580</td>
      <td>5.213019</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s also plot this data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">weekly_delays</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># tweak spacing between subplots and xaxis labels</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">weekly_delays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, %b. </span><span class="si">%d</span><span class="s2">&#39;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7e711c357e7070d47e4af6476d31a3fc6db40a100a5ddb34b310b4e93286c602.png" src="../../_images/7e711c357e7070d47e4af6476d31a3fc6db40a100a5ddb34b310b4e93286c602.png" />
</div>
</div>
<p>It looks like more delays occurred during the week ending Sunday
December 18th than any other week (except for Frontier, who did <em>worse</em>
on Christmas week).</p>
<p>Let’s see why.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">air_dec</span></code> DataFrame has information on the minutes of delay
attributed to 5 different categories:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delay_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;CarrierDelay&#39;</span><span class="p">,</span>
    <span class="s1">&#39;WeatherDelay&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NASDelay&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SecurityDelay&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LateAircraftDelay&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a quick look at each of those delay categories for the week ending December 18, 2016.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pre_christmas</span> <span class="o">=</span> <span class="n">air_dec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">(</span><span class="n">air_dec</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;2016-12-12&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">air_dec</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s2">&quot;2016-12-18&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># custom agg function</span>
<span class="k">def</span> <span class="nf">positive</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">delay_totals</span> <span class="o">=</span> <span class="n">pre_christmas</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Carrier&quot;</span><span class="p">)[</span><span class="n">delay_cols</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="p">])</span>
<span class="n">delay_totals</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">CarrierDelay</th>
      <th colspan="3" halign="left">WeatherDelay</th>
      <th colspan="3" halign="left">NASDelay</th>
      <th colspan="3" halign="left">SecurityDelay</th>
      <th colspan="3" halign="left">LateAircraftDelay</th>
    </tr>
    <tr>
      <th></th>
      <th>sum</th>
      <th>mean</th>
      <th>positive</th>
      <th>sum</th>
      <th>mean</th>
      <th>positive</th>
      <th>sum</th>
      <th>mean</th>
      <th>positive</th>
      <th>sum</th>
      <th>mean</th>
      <th>positive</th>
      <th>sum</th>
      <th>mean</th>
      <th>positive</th>
    </tr>
    <tr>
      <th>Carrier</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AA</th>
      <td>105732.0</td>
      <td>6.258553</td>
      <td>2922.0</td>
      <td>21820.0</td>
      <td>1.291583</td>
      <td>456.0</td>
      <td>77279.0</td>
      <td>4.574346</td>
      <td>3159.0</td>
      <td>721.0</td>
      <td>0.042678</td>
      <td>35.0</td>
      <td>141249.0</td>
      <td>8.360897</td>
      <td>2574.0</td>
    </tr>
    <tr>
      <th>AS</th>
      <td>8762.0</td>
      <td>2.691032</td>
      <td>250.0</td>
      <td>3219.0</td>
      <td>0.988636</td>
      <td>61.0</td>
      <td>16344.0</td>
      <td>5.019656</td>
      <td>614.0</td>
      <td>163.0</td>
      <td>0.050061</td>
      <td>10.0</td>
      <td>13599.0</td>
      <td>4.176597</td>
      <td>271.0</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>49421.0</td>
      <td>9.031615</td>
      <td>1575.0</td>
      <td>9894.0</td>
      <td>1.808114</td>
      <td>112.0</td>
      <td>38741.0</td>
      <td>7.079861</td>
      <td>1326.0</td>
      <td>672.0</td>
      <td>0.122807</td>
      <td>30.0</td>
      <td>100811.0</td>
      <td>18.423063</td>
      <td>1433.0</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>151188.0</td>
      <td>8.864212</td>
      <td>2878.0</td>
      <td>39145.0</td>
      <td>2.295087</td>
      <td>783.0</td>
      <td>75110.0</td>
      <td>4.403729</td>
      <td>2605.0</td>
      <td>107.0</td>
      <td>0.006273</td>
      <td>2.0</td>
      <td>122896.0</td>
      <td>7.205441</td>
      <td>2289.0</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>87408.0</td>
      <td>9.939504</td>
      <td>1375.0</td>
      <td>3824.0</td>
      <td>0.434842</td>
      <td>76.0</td>
      <td>49703.0</td>
      <td>5.651922</td>
      <td>1580.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>89773.0</td>
      <td>10.208438</td>
      <td>1568.0</td>
    </tr>
    <tr>
      <th>F9</th>
      <td>19568.0</td>
      <td>10.430704</td>
      <td>361.0</td>
      <td>6198.0</td>
      <td>3.303838</td>
      <td>57.0</td>
      <td>22459.0</td>
      <td>11.971748</td>
      <td>493.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>32236.0</td>
      <td>17.183369</td>
      <td>316.0</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>7199.0</td>
      <td>5.034266</td>
      <td>218.0</td>
      <td>3650.0</td>
      <td>2.552448</td>
      <td>145.0</td>
      <td>86.0</td>
      <td>0.060140</td>
      <td>4.0</td>
      <td>35.0</td>
      <td>0.024476</td>
      <td>3.0</td>
      <td>4024.0</td>
      <td>2.813986</td>
      <td>189.0</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>14735.0</td>
      <td>5.294646</td>
      <td>452.0</td>
      <td>2240.0</td>
      <td>0.804887</td>
      <td>56.0</td>
      <td>30361.0</td>
      <td>10.909450</td>
      <td>840.0</td>
      <td>50.0</td>
      <td>0.017966</td>
      <td>5.0</td>
      <td>22247.0</td>
      <td>7.993891</td>
      <td>372.0</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>120307.0</td>
      <td>10.439691</td>
      <td>1378.0</td>
      <td>26349.0</td>
      <td>2.286446</td>
      <td>308.0</td>
      <td>54141.0</td>
      <td>4.698108</td>
      <td>2289.0</td>
      <td>171.0</td>
      <td>0.014839</td>
      <td>12.0</td>
      <td>166102.0</td>
      <td>14.413572</td>
      <td>2459.0</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>66693.0</td>
      <td>6.312636</td>
      <td>1851.0</td>
      <td>31602.0</td>
      <td>2.991197</td>
      <td>521.0</td>
      <td>74992.0</td>
      <td>7.098154</td>
      <td>2065.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>118728.0</td>
      <td>11.237861</td>
      <td>1696.0</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>8048.0</td>
      <td>5.608362</td>
      <td>246.0</td>
      <td>3807.0</td>
      <td>2.652962</td>
      <td>126.0</td>
      <td>12619.0</td>
      <td>8.793728</td>
      <td>224.0</td>
      <td>73.0</td>
      <td>0.050871</td>
      <td>4.0</td>
      <td>25242.0</td>
      <td>17.590244</td>
      <td>331.0</td>
    </tr>
    <tr>
      <th>WN</th>
      <td>123882.0</td>
      <td>4.873790</td>
      <td>5393.0</td>
      <td>23516.0</td>
      <td>0.925171</td>
      <td>328.0</td>
      <td>78645.0</td>
      <td>3.094067</td>
      <td>4247.0</td>
      <td>252.0</td>
      <td>0.009914</td>
      <td>18.0</td>
      <td>285073.0</td>
      <td>11.215399</td>
      <td>6472.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Want</strong>: plot total, average, and number of each type of delay by
carrier</p>
<p>To do this, we need to have a DataFrame with:</p>
<ul class="simple">
<li><p>Delay type in index (so it is on horizontal-axis)</p></li>
<li><p>Aggregation method on <em>outer</em> most level of columns (so we can do
<code class="docutils literal notranslate"><span class="pre">data[&quot;mean&quot;]</span></code> to get averages)</p></li>
<li><p>Carrier name on inner level of columns</p></li>
</ul>
<p>Many sequences of the reshaping commands can accomplish this.</p>
<p>We show one example below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_delays</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">delay_totals</span>
    <span class="o">.</span><span class="n">stack</span><span class="p">()</span>             <span class="c1"># move aggregation method into index (with Carrier)</span>
    <span class="o">.</span><span class="n">T</span>                   <span class="c1"># put delay type in index and Carrier+agg in column</span>
    <span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># make agg method outer level of column label</span>
    <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort column labels so it prints nicely</span>
<span class="p">)</span>
<span class="n">reshaped_delays</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="10" halign="left">mean</th>
      <th>...</th>
      <th colspan="10" halign="left">sum</th>
    </tr>
    <tr>
      <th>Carrier</th>
      <th>AA</th>
      <th>AS</th>
      <th>B6</th>
      <th>DL</th>
      <th>EV</th>
      <th>F9</th>
      <th>HA</th>
      <th>NK</th>
      <th>OO</th>
      <th>UA</th>
      <th>...</th>
      <th>B6</th>
      <th>DL</th>
      <th>EV</th>
      <th>F9</th>
      <th>HA</th>
      <th>NK</th>
      <th>OO</th>
      <th>UA</th>
      <th>VX</th>
      <th>WN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CarrierDelay</th>
      <td>6.258553</td>
      <td>2.691032</td>
      <td>9.031615</td>
      <td>8.864212</td>
      <td>9.939504</td>
      <td>10.430704</td>
      <td>5.034266</td>
      <td>5.294646</td>
      <td>10.439691</td>
      <td>6.312636</td>
      <td>...</td>
      <td>49421.0</td>
      <td>151188.0</td>
      <td>87408.0</td>
      <td>19568.0</td>
      <td>7199.0</td>
      <td>14735.0</td>
      <td>120307.0</td>
      <td>66693.0</td>
      <td>8048.0</td>
      <td>123882.0</td>
    </tr>
    <tr>
      <th>WeatherDelay</th>
      <td>1.291583</td>
      <td>0.988636</td>
      <td>1.808114</td>
      <td>2.295087</td>
      <td>0.434842</td>
      <td>3.303838</td>
      <td>2.552448</td>
      <td>0.804887</td>
      <td>2.286446</td>
      <td>2.991197</td>
      <td>...</td>
      <td>9894.0</td>
      <td>39145.0</td>
      <td>3824.0</td>
      <td>6198.0</td>
      <td>3650.0</td>
      <td>2240.0</td>
      <td>26349.0</td>
      <td>31602.0</td>
      <td>3807.0</td>
      <td>23516.0</td>
    </tr>
    <tr>
      <th>NASDelay</th>
      <td>4.574346</td>
      <td>5.019656</td>
      <td>7.079861</td>
      <td>4.403729</td>
      <td>5.651922</td>
      <td>11.971748</td>
      <td>0.060140</td>
      <td>10.909450</td>
      <td>4.698108</td>
      <td>7.098154</td>
      <td>...</td>
      <td>38741.0</td>
      <td>75110.0</td>
      <td>49703.0</td>
      <td>22459.0</td>
      <td>86.0</td>
      <td>30361.0</td>
      <td>54141.0</td>
      <td>74992.0</td>
      <td>12619.0</td>
      <td>78645.0</td>
    </tr>
    <tr>
      <th>SecurityDelay</th>
      <td>0.042678</td>
      <td>0.050061</td>
      <td>0.122807</td>
      <td>0.006273</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.024476</td>
      <td>0.017966</td>
      <td>0.014839</td>
      <td>0.000000</td>
      <td>...</td>
      <td>672.0</td>
      <td>107.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>35.0</td>
      <td>50.0</td>
      <td>171.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>252.0</td>
    </tr>
    <tr>
      <th>LateAircraftDelay</th>
      <td>8.360897</td>
      <td>4.176597</td>
      <td>18.423063</td>
      <td>7.205441</td>
      <td>10.208438</td>
      <td>17.183369</td>
      <td>2.813986</td>
      <td>7.993891</td>
      <td>14.413572</td>
      <td>11.237861</td>
      <td>...</td>
      <td>100811.0</td>
      <td>122896.0</td>
      <td>89773.0</td>
      <td>32236.0</td>
      <td>4024.0</td>
      <td>22247.0</td>
      <td>166102.0</td>
      <td>118728.0</td>
      <td>25242.0</td>
      <td>285073.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 36 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">]:</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">reshaped_delays</span><span class="p">[</span><span class="n">agg</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>
<span class="c1">#     fig.tight_layout();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dadf8d16b520af4ca13f6045a862e736fac9449dad070f713a38a8066d4567df.png" src="../../_images/dadf8d16b520af4ca13f6045a862e736fac9449dad070f713a38a8066d4567df.png" />
<img alt="../../_images/a239b3be259c2f0c9772cca93db941f7629334c54ee85b3cca854f3753fd9a2b.png" src="../../_images/a239b3be259c2f0c9772cca93db941f7629334c54ee85b3cca854f3753fd9a2b.png" />
<img alt="../../_images/46bc6b74145b81f7288bc7cfeac1af9ca7424857a861630bb6c35aa99e4c45eb.png" src="../../_images/46bc6b74145b81f7288bc7cfeac1af9ca7424857a861630bb6c35aa99e4c45eb.png" />
</div>
</div>
<p><a id='exercise-3'></a></p>
<blockquote>
<div><p>See exercise 4 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>Let’s summarize what we did:</p>
<ul class="simple">
<li><p>Computed average flight delay for each airline for each week.</p></li>
<li><p>Noticed that one week had more delays for all airlines.</p></li>
<li><p>Studied the flights in that week to determine the <em>cause</em> of the
delays in that week.</p></li>
</ul>
<p>Suppose now that we want to repeat that analysis, but at a daily
frequency instead of weekly.</p>
<p>We could copy/paste the code from above and change the <code class="docutils literal notranslate"><span class="pre">W</span></code> to a <code class="docutils literal notranslate"><span class="pre">D</span></code>,
but there’s a better way…</p>
<p>Let’s convert the steps above into two functions:</p>
<ol class="arabic simple">
<li><p>Produce the set of bar charts for average delays at each frequency.</p></li>
<li><p>Produce the second set of charts for the total, average, and number
of occurrences of each type of delay.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_delay_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a bar chart of average flight delays for each carrier at</span>
<span class="sd">    a given frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_delays</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">),</span> <span class="s2">&quot;Carrier&quot;</span><span class="p">])</span>
        <span class="p">[</span><span class="s2">&quot;ArrDelay&quot;</span><span class="p">]</span>               <span class="c1"># extract one column</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>                    <span class="c1"># take average</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;Carrier&quot;</span><span class="p">)</span>  <span class="c1"># Flip carrier up as column names</span>
    <span class="p">)</span>

    <span class="c1"># plot</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">mean_delays</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># tweak spacing between subplots and x-axis labels</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">mean_delays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, %b. </span><span class="si">%d</span><span class="s2">&#39;&quot;</span><span class="p">))</span>

    <span class="c1"># return the axes in case we want to further tweak the plot outside the function</span>
    <span class="k">return</span> <span class="n">axs</span>


<span class="k">def</span> <span class="nf">delay_type_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make bar charts for total minutes, average minutes, and number of</span>
<span class="sd">    occurrences for each delay type, for all flights that were scheduled</span>
<span class="sd">    between `start` date and `end` date</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sub_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">positive</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">aggs</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Carrier&quot;</span><span class="p">)[</span><span class="n">delay_cols</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="p">])</span>

    <span class="n">reshaped</span> <span class="o">=</span> <span class="n">aggs</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">]:</span>
        <span class="n">axs</span> <span class="o">=</span> <span class="n">reshaped</span><span class="p">[</span><span class="n">agg</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>
<span class="c1">#         fig.tight_layout();</span>
</pre></div>
</div>
</div>
</div>
<p><a id='exercise-4'></a></p>
<blockquote>
<div><p>See exercise 5 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>Now let’s look at that plot at a daily frequency. (Note that we need the
figure to be a bit wider in order to see the dates.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_delay_plot</span><span class="p">(</span><span class="n">air_dec</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f7460936d33a37f22394d70b54f745099007ec8814b55e56f1ea3cb3cd99ccdb.png" src="../../_images/f7460936d33a37f22394d70b54f745099007ec8814b55e56f1ea3cb3cd99ccdb.png" />
</div>
</div>
<p>As we expected given our analysis above, the longest average delays
seemed to happen in the third week.</p>
<p>In particular, it looks like December 17th and 18th had — on average —
higher delays than other days in December.</p>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">delay_type_plot</span></code> function to determine the cause of the
delays on those two days.</p>
<p>Because our analysis is captured in a single function, we can look at
the days together and separately without much effort.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># both days</span>
<span class="n">delay_type_plot</span><span class="p">(</span><span class="n">air_dec</span><span class="p">,</span> <span class="s2">&quot;12-17-16&quot;</span><span class="p">,</span> <span class="s2">&quot;12-18-16&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5f837dbbd904cfc455ffb1d80a63f9ab9517bc6fb6788976fe56730fe05f3420.png" src="../../_images/5f837dbbd904cfc455ffb1d80a63f9ab9517bc6fb6788976fe56730fe05f3420.png" />
<img alt="../../_images/312c292533e13416ec166eaeac5607f037a2983019f2f0b0c59f9d2bc7283ab6.png" src="../../_images/312c292533e13416ec166eaeac5607f037a2983019f2f0b0c59f9d2bc7283ab6.png" />
<img alt="../../_images/4e17af2c34fb790edf89e76e7b617ca3215375c0c65a5c71a8e68ec14f2397c7.png" src="../../_images/4e17af2c34fb790edf89e76e7b617ca3215375c0c65a5c71a8e68ec14f2397c7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only the 17th</span>
<span class="n">delay_type_plot</span><span class="p">(</span><span class="n">air_dec</span><span class="p">,</span> <span class="s2">&quot;12-17-16&quot;</span><span class="p">,</span> <span class="s2">&quot;12-17-16&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/066f3ca19866964926756d18635c63f0e380ade90a297c560c53e2657fe13e84.png" src="../../_images/066f3ca19866964926756d18635c63f0e380ade90a297c560c53e2657fe13e84.png" />
<img alt="../../_images/937c01d4e0fc7adbfede529569eb6e75e0661f2a24fdbbd40136c89a3a1a8cbd.png" src="../../_images/937c01d4e0fc7adbfede529569eb6e75e0661f2a24fdbbd40136c89a3a1a8cbd.png" />
<img alt="../../_images/aa4cc6deee9a3982ead821309628234de9598d2e200d4591d58e9c5ab40f1e9e.png" src="../../_images/aa4cc6deee9a3982ead821309628234de9598d2e200d4591d58e9c5ab40f1e9e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only the 18th</span>
<span class="n">delay_type_plot</span><span class="p">(</span><span class="n">air_dec</span><span class="p">,</span> <span class="s2">&quot;12-18-16&quot;</span><span class="p">,</span> <span class="s2">&quot;12-18-16&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/034641b5c880bf0b6bc27067a9e134a0c31c7eea8e4fe24eecf5de920ecd1ea4.png" src="../../_images/034641b5c880bf0b6bc27067a9e134a0c31c7eea8e4fe24eecf5de920ecd1ea4.png" />
<img alt="../../_images/914aa605078eb4d90ecef629e909a8aff580b445ed09ba5757e27aa79dfa74d3.png" src="../../_images/914aa605078eb4d90ecef629e909a8aff580b445ed09ba5757e27aa79dfa74d3.png" />
<img alt="../../_images/a57e68a0a41c132797bf759d2e532746bbed8e8f420a16a537783e535db9be2d.png" src="../../_images/a57e68a0a41c132797bf759d2e532746bbed8e8f420a16a537783e535db9be2d.png" />
</div>
</div>
<p>The purpose of this exercise was to drive home the ability to <em>automate</em>
tasks.</p>
<p>We were able to write a pair of <code class="docutils literal notranslate"><span class="pre">functions</span></code> that allows us to easily
repeat the exact same analysis on different subsets of the data, or
different datasets entirely (e.g. we could do the same analysis on
November 2016 data, with two lines of code).</p>
<p>These principles can be applied in many settings.</p>
<p>Keep that in mind as we work through the rest of the materials.</p>
</section>
<section id="exercise-cohort-analysis-using-shopify-data">
<h2><span class="section-number">5.8.4. </span>Exercise: Cohort Analysis using Shopify Data<a class="headerlink" href="#exercise-cohort-analysis-using-shopify-data" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">qeds</span></code> library includes routines to simulate data sets in the
format of common sources</p>
<p>One of these sources is <a class="reference external" href="https://www.shopify.com/">Shopify</a> — an
e-commerce platform used by many retail companies for online sales</p>
<p>The code below will simulate a fairly large data set that has the
properties of a order-detail report from Shopify</p>
<p>We’ll first look at the data, and then describe the exercise</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the &quot;randomness&quot; seeds</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">orders</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shopify</span><span class="o">.</span><span class="n">simulate_orders</span><span class="p">(</span><span class="mi">500000</span><span class="p">)</span>
<span class="n">orders</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="n">orders</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 501522 entries, 0 to 501521
Data columns (total 14 columns):
Day                  501522 non-null object
customer_type        501522 non-null object
Customer ID          501522 non-null int64
orders               501522 non-null int64
total_sales          501522 non-null float64
Returns              501522 non-null float64
Ordered quantity     501522 non-null int64
Gross sales          501522 non-null float64
Net sales            501522 non-null float64
Shipping             501522 non-null float64
Tax                  501522 non-null float64
Net quantity         501522 non-null int64
Returned quantity    501522 non-null int64
Discounts            501522 non-null float64
dtypes: float64(7), int64(5), object(2)
memory usage: 53.6+ MB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Day</th>
      <th>customer_type</th>
      <th>Customer ID</th>
      <th>orders</th>
      <th>total_sales</th>
      <th>Returns</th>
      <th>Ordered quantity</th>
      <th>Gross sales</th>
      <th>Net sales</th>
      <th>Shipping</th>
      <th>Tax</th>
      <th>Net quantity</th>
      <th>Returned quantity</th>
      <th>Discounts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-06</td>
      <td>Returning</td>
      <td>1825044237</td>
      <td>1</td>
      <td>66.02</td>
      <td>-0.0</td>
      <td>7</td>
      <td>66.02</td>
      <td>66.02</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>7</td>
      <td>0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-11-08</td>
      <td>Returning</td>
      <td>5738410335</td>
      <td>1</td>
      <td>3.91</td>
      <td>-0.0</td>
      <td>2</td>
      <td>3.45</td>
      <td>3.45</td>
      <td>0.0</td>
      <td>0.46</td>
      <td>2</td>
      <td>0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-09</td>
      <td>First-time</td>
      <td>8183772638</td>
      <td>1</td>
      <td>62.25</td>
      <td>-0.0</td>
      <td>7</td>
      <td>62.25</td>
      <td>62.25</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>7</td>
      <td>0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2014-04-22</td>
      <td>First-time</td>
      <td>661927852</td>
      <td>1</td>
      <td>153.78</td>
      <td>-0.0</td>
      <td>3</td>
      <td>153.78</td>
      <td>153.78</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>3</td>
      <td>0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-03-17</td>
      <td>Returning</td>
      <td>5481518024</td>
      <td>1</td>
      <td>13.51</td>
      <td>-0.0</td>
      <td>1</td>
      <td>13.51</td>
      <td>13.51</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1</td>
      <td>0</td>
      <td>-0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We define a customer’s cohort as the month in which a customer placed
their first order and the customer type as an indicator of whether this
was their first order or a returning order.</p>
<p>We now describe the <em>want</em> for the exercise, which we ask you to
complete.</p>
<p><strong>Want</strong>: Compute the monthly total number of orders, total sales, and
total quantity separated by customer cohort and customer type.</p>
<p>Read that carefully one more time…</p>
<section id="extended-exercise">
<h3><span class="section-number">5.8.4.1. </span>Extended Exercise<a class="headerlink" href="#extended-exercise" title="Permalink to this heading">#</a></h3>
<p>Using the reshape and <code class="docutils literal notranslate"><span class="pre">groupby</span></code> tools you have learned, apply the want
operator described above.</p>
<p>See below for advice on how to proceed.</p>
<p>When you are finished, you should have something that looks like this:</p>
<img src="https://datascience.quantecon.org/assets/_static/groupby_files/groupby_cohort_analysis_exercise_output.png" alt="groupby\_cohort\_analysis\_exercise\_output.png" style="">
<p>Two notes on the table above:</p>
<ol class="arabic simple">
<li></li>
</ol>
  <dl style='margin: 20px 0;'>
  <dt>Your actual output will be much bigger. This is just to give you an</dt>
  <dd>
  idea of what it might look like.  
  </dd>
  </dl>
<ol class="arabic simple">
<li></li>
</ol>
  <dl style='margin: 20px 0;'>
  <dt>The numbers you produce should actually be the same as what are</dt>
  <dd>
  included in this table… Index into your answer and compare what you
  have with this table to verify your progress.  
  </dd>
  </dl>
<p>Now, how to do it?</p>
<p>There is more than one way to code this, but here are some suggested
steps.</p>
<ol class="arabic simple">
<li><p>Convert the <code class="docutils literal notranslate"><span class="pre">Day</span></code> column to have a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code> instead
of object (Hint: use the <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> function).</p></li>
<li><p>Add a new column that specifies the date associated with each
customer’s <code class="docutils literal notranslate"><span class="pre">&quot;First-time&quot;</span></code> order.</p></li>
</ol>
<ul class="simple">
<li><p>Hint 1: You can do this with a combination of <code class="docutils literal notranslate"><span class="pre">groupby</span></code> and
<code class="docutils literal notranslate"><span class="pre">join</span></code>.</p></li>
<li><p>Hint 2: <code class="docutils literal notranslate"><span class="pre">customer_type</span></code> is always one of <code class="docutils literal notranslate"><span class="pre">Returning</span></code> and
<code class="docutils literal notranslate"><span class="pre">First-time</span></code>.</p></li>
<li><p>Hint 3: Some customers don’t have a
<code class="docutils literal notranslate"><span class="pre">customer_type</span> <span class="pre">==</span> <span class="pre">&quot;First-time&quot;</span></code> entry. You will need to set the
value for these users to some date that precedes the dates in the
sample. After adding valid data back into <code class="docutils literal notranslate"><span class="pre">orders</span></code> DataFrame,
you can identify which customers don’t have a <code class="docutils literal notranslate"><span class="pre">&quot;First-Time&quot;</span></code>
entry by checking for missing data in the new column.</p></li>
</ul>
<ol class="arabic simple">
<li><p>You’ll need to group by 3 things.</p></li>
<li><p>You can apply one of the built-in aggregation functions to the GroupBy.</p></li>
<li><p>After doing the aggregation, you’ll need to use your reshaping skills to
move things to the right place in rows and columns.</p></li>
</ol>
<p>Good luck!</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">5.8.5. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p><a id='exerciselist-0'></a>
<strong>Exercise 1</strong></p>
<p>Look closely at the output of the cells below.</p>
<p>How did pandas compute the sum of <code class="docutils literal notranslate"><span class="pre">gbA</span></code>? What happened to the <code class="docutils literal notranslate"><span class="pre">NaN</span></code>
entries in column <code class="docutils literal notranslate"><span class="pre">C</span></code>?</p>
<p>Write your thoughts.</p>
<p>Hint: try <code class="docutils literal notranslate"><span class="pre">gbA.count()</span></code> or <code class="docutils literal notranslate"><span class="pre">gbA.mean()</span></code> if you can’t decide what
happened to the <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbA</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 2</strong></p>
<p>Use introspection (tab completion) to see what other aggregations are
defined for GroupBy objects.</p>
<p>Pick three and evaluate them in the cells below.</p>
<p>Does the output of each of these commands have the same features as the
output of <code class="docutils literal notranslate"><span class="pre">gbA.sum()</span></code> from above? If not, what is different?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># method 1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># method 2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># method 3</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 3</strong></p>
<blockquote>
<div><p>This exercise has a few steps:</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>Write a function that, given a DataFrame, computes each entry’s
deviation from the mean of its column.</p></li>
<li><p>Apply the function to <code class="docutils literal notranslate"><span class="pre">gbA</span></code>.</p></li>
<li><p>With your neighbor describe what the index and and columns are? Where
are the group keys (the <code class="docutils literal notranslate"><span class="pre">A</span></code> column)?</p></li>
<li><p>Determine the correct way to add these results back into <code class="docutils literal notranslate"><span class="pre">df</span></code> as
new columns. (Hint: remember the merge lecture)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># write function here</span>


<span class="c1"># apply function here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add output of function as new columns to df here...</span>
</pre></div>
</div>
</div>
</div>
<dl style='margin: 20px 0;'>
<dt>Note that if the group keys</dt>
<dd>
remained in the index as the `.apply`'s output, the merge/join step would
have been complicated.
</dd>
</dl>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 4</strong></p>
<p>Think about what is shown in the the plots above.</p>
<p>Answer questions like:</p>
<ul class="simple">
<li><p>Which type of delay was the most common?</p></li>
<li><p>Which one caused the largest average delay?</p></li>
<li><p>Does that vary by airline?</p></li>
</ul>
<p>Write your thoughts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here if needed</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 5</strong></p>
<p>Verify that we wrote the functions properly by setting the arguments to
appropriate values to replicate the plots from above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># call mean_delay_plot here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># call delay_type_plot here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="merge.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.7. </span>Merge (opt)</p>
      </div>
    </a>
    <a class="right-next"
       href="matplotlib.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.9. </span>Intermediate Plotting (opt)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.8.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-apply-combine">5.8.2. Split-Apply-Combine</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-example">5.8.2.1. Simple Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-aggregate-functions">5.8.2.2. Custom Aggregate Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-the-apply-method">5.8.2.3. Transforms: The <code class="docutils literal notranslate"><span class="pre">apply</span></code> Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-grouper">5.8.2.4. <code class="docutils literal notranslate"><span class="pre">pd.Grouper</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-airline-delays">5.8.3. Case Study: Airline Delays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-cohort-analysis-using-shopify-data">5.8.4. Exercise: Cohort Analysis using Shopify Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-exercise">5.8.4.1. Extended Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.8.5. Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>