

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.7. Merge (opt) &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/pandas/merge';</script>
    <link rel="canonical" href="https://amoreira2.github.io/quantitativeinvesting/chapters/pandas/merge.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.8. GroupBy (opt)" href="groupby.html" />
    <link rel="prev" title="5.6. Reshape (opt)" href="reshape.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03/programming-in-python.html">3. First Steps with Python</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/essentials.html">4. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">4.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">4.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">4.3. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">4.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy1.html">4.5. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting1.html">4.6. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="workingwithdata.html">5. Working with Data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html">5.2. Pandas Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_index.html">5.3. Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html">5.4. Time-Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_clean.html">5.5. Cleaning data (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshape.html">5.6. Reshape (opt)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.7. Merge (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html">5.8. Group-by (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="matplotlib.html">5.9. Plotting (opt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage_formats.html">5.10. Data Storage (opt)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Returns.html">6. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Returns1.html">6.1. Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">6.2. Modeling randomness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TheChoiceofFrequency.html">6.3. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.4. Linear algebra Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/UsingAPI.html">6.5. Data APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/PortfolioMath.html">7. Portfolio Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/CapitalAllocationLine.html">8. Capital Allocation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/meanvariance1.html">9. Mean Variance Frontier</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MeanVariance.html">9.1. Mean Variance Efficient Portfolios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/CaseStudy.html">9.2. Case Study in International Diversification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/LeverageandShorting.html">9.3. Leverage and Shorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Portfoliooptimizationwithconstraints.html">9.4. Portfolio Optimization with constraints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/EstimationUncertainty.html">10. Estimation Uncertainty and It's Implications for investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/TradingStrategies.html">11. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Timing.html">12. Timing Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Volatilitytiming.html">12.1. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/crosssectionalequitystrategies.html">13. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Valueinvesting.html">13.1. Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Momentum.html">13.2. Momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/OtherEquityStrategies.html">13.3. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Evaluation.html">14. Evaluating a Trading Strategy</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Econometrics.html">14.1. The Econometrics of Strategy Evalaution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/outofsample.html">14.2. Out of Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TailandBackground.html">14.3. Tail Risks and Background Risks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MultiFactorModels.html">14.4. Multifactor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Topics.html">15. Topics in Quantitative Investing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Equilbrium.html">15.1. Intepreting Factor models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Implementation.html">15.2. Strategy Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Horizon.html">15.3. Investment horizon effects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">16. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">17. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">17.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">17.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">17.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">17.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">17.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">17.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">17.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">17.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Lectures/blob/main/chapters/pandas/merge.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Lectures/issues/new?title=Issue%20on%20page%20%2Fchapters/pandas/merge.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/pandas/merge.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Merge (opt)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.7.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-datasets">5.7.2. Combining Datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-concat">5.7.3. <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axis-0">5.7.3.1. <code class="docutils literal notranslate"><span class="pre">axis=0</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axis-1">5.7.3.2. <code class="docutils literal notranslate"><span class="pre">axis=1</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-merge">5.7.4. <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-columns">5.7.4.1. Multiple Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arguments-to-merge">5.7.5. Arguments to <code class="docutils literal notranslate"><span class="pre">merge</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#on">5.7.5.1. <code class="docutils literal notranslate"><span class="pre">on</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-on-right-on">5.7.5.2. <code class="docutils literal notranslate"><span class="pre">left_on</span></code>, <code class="docutils literal notranslate"><span class="pre">right_on</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-index-right-index">5.7.5.3. <code class="docutils literal notranslate"><span class="pre">left_index</span></code>, <code class="docutils literal notranslate"><span class="pre">right_index</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how">5.7.5.4. <code class="docutils literal notranslate"><span class="pre">how</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#df-merge-df2">5.7.5.5. <code class="docutils literal notranslate"><span class="pre">df.merge(df2)</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#df-join">5.7.6. <code class="docutils literal notranslate"><span class="pre">df.join</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study">5.7.7. Case Study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#book-data">5.7.7.1. Book Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-example-airline-delays">5.7.8. Extra Example: Airline Delays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-merge-operations">5.7.9. Visualizing Merge Operations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5.7.9.1. <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.7.9.2. <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-with-artificial-data">5.7.9.3. Exercises With Artificial Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.7.10. Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="merge-opt">
<h1><span class="section-number">5.7. </span>Merge (opt)<a class="headerlink" href="#merge-opt" title="Permalink to this heading">#</a></h1>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="reshape.html"><span class="doc std std-doc">Reshape</span></a></p></li>
</ul>
<p><strong>Outcomes</strong></p>
<ul class="simple">
<li><p>Know the different pandas routines for combining datasets</p></li>
<li><p>Know when to use <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code> vs <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> vs <code class="docutils literal notranslate"><span class="pre">pd.join</span></code></p></li>
<li><p>Be able to apply the three main combining routines</p></li>
</ul>
<p><strong>Data</strong></p>
<ul class="simple">
<li><p>WDI data on GDP components, population, and square miles of countries</p></li>
<li><p>Book ratings: 6,000,000 ratings for the 10,000 most rated books on
<a class="reference external" href="https://www.goodreads.com/">Goodreads</a></p></li>
<li><p>Details for all delayed US domestic flights in November 2016,
obtained from the <a class="reference external" href="https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&amp;DB_Short_Name=On-Time">Bureau of Transportation
Statistics</a></p></li>
</ul>
<section id="outline">
<h2><span class="section-number">5.7.1. </span>Outline<a class="headerlink" href="#outline" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><span class="xref myst">Merge</span></p>
<ul>
<li><p><span class="xref myst">Combining Datasets</span></p></li>
<li><p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">pd.concat</span></code></span></p></li>
<li><p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">pd.merge</span></code></span></p></li>
<li><p><span class="xref myst">Arguments to <code class="docutils literal notranslate"><span class="pre">merge</span></code></span></p></li>
<li><p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">df.join</span></code></span></p></li>
<li><p><span class="xref myst">Case Study</span></p></li>
<li><p><span class="xref myst">Extra Example: Airline Delays</span></p></li>
<li><p><span class="xref myst">Visualizing Merge Operations</span></p></li>
<li><p><span class="xref myst">Exercises</span></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment following line to install on colab</span>
<span class="c1">#! pip install qeds</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="combining-datasets">
<h2><span class="section-number">5.7.2. </span>Combining Datasets<a class="headerlink" href="#combining-datasets" title="Permalink to this heading">#</a></h2>
<p>Often, we will want perform joint analysis on data from different sources.</p>
<p>For example, when analyzing the regional sales for a company, we might
want to include industry aggregates or demographic information for each
region.</p>
<p>Or perhaps we are working with product-level data, have a list of
product groups in a separate dataset, and want to compute aggregate
statistics for each group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># activate plot theme</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="n">qeds</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">mpl_style</span><span class="p">();</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from WDI. Units trillions of 2010 USD</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://datascience.quantecon.org/assets/data/wdi_data.csv&quot;</span>
<span class="n">wdi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
<span class="n">wdi</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="n">wdi2017</span> <span class="o">=</span> <span class="n">wdi</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="n">wdi2017</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
MultiIndex: 72 entries, (Canada, 2017) to (United States, 2000)
Data columns (total 5 columns):
GovExpend      72 non-null float64
Consumption    72 non-null float64
Exports        72 non-null float64
Imports        72 non-null float64
GDP            72 non-null float64
dtypes: float64(5)
memory usage: 3.2+ KB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi2016_17</span> <span class="o">=</span> <span class="n">wdi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">]],:</span> <span class="p">]</span>
<span class="n">wdi2016_17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
    </tr>
    <tr>
      <th>country</th>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Canada</th>
      <th>2017</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.364899</td>
      <td>1.058426</td>
      <td>0.576394</td>
      <td>0.575775</td>
      <td>1.814016</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Germany</th>
      <th>2017</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.734014</td>
      <td>2.075615</td>
      <td>1.844949</td>
      <td>1.589495</td>
      <td>3.801859</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">United Kingdom</th>
      <th>2017</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.550596</td>
      <td>1.772348</td>
      <td>0.816792</td>
      <td>0.901494</td>
      <td>2.768241</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">United States</th>
      <th>2017</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>2.407981</td>
      <td>11.722133</td>
      <td>2.219937</td>
      <td>2.936004</td>
      <td>16.972348</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data from https://www.nationmaster.com/country-info/stats/Geography/Land-area/Square-miles</span>
<span class="c1"># units -- millions of square miles</span>
<span class="n">sq_miles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
   <span class="s2">&quot;United States&quot;</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">,</span>
   <span class="s2">&quot;Canada&quot;</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">,</span>
   <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="mf">0.137</span><span class="p">,</span>
   <span class="s2">&quot;United Kingdom&quot;</span><span class="p">:</span> <span class="mf">0.0936</span><span class="p">,</span>
   <span class="s2">&quot;Russia&quot;</span><span class="p">:</span> <span class="mf">6.6</span><span class="p">,</span>
<span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sq_miles&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">sq_miles</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;country&quot;</span>
<span class="n">sq_miles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>United States</th>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from WDI. Units millions of people</span>
<span class="n">pop_url</span> <span class="o">=</span> <span class="s2">&quot;https://datascience.quantecon.org/assets/data/wdi_population.csv&quot;</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pop_url</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
<span class="n">pop</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">pop</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
MultiIndex: 72 entries, (Canada, 2017) to (United States, 2000)
Data columns (total 1 columns):
Population    72 non-null float64
dtypes: float64(1)
memory usage: 1005.0+ bytes
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Population</th>
    </tr>
    <tr>
      <th>country</th>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="10" valign="top">Canada</th>
      <th>2017</th>
      <td>36.540268</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>36.109487</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>35.702908</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>35.437435</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>35.082954</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>34.714222</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>34.339328</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>34.004889</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>33.628895</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>33.247118</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Suppose that we were asked to compute a number of statistics with the data above:</p>
<ul class="simple">
<li><p>As a measure of land usage or productivity, what is Consumption per square mile?</p></li>
<li><p>What is GDP per capita (per person) for each country in each year? How about
Consumption per person?</p></li>
<li><p>What is the population density of each country? How much does it change over time?</p></li>
</ul>
<p>Notice that to answer any of the questions from above, we will have to use data
from more than one of our DataFrames.</p>
<p>In this lecture, we will learn many techniques for combining datasets that
originate from different sources, careful to ensure that data is properly
aligned.</p>
<p>In pandas three main methods can combine datasets:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pd.concat([dfs...])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pd.merge(df1,</span> <span class="pre">df2)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df1.join(df2)</span></code></p></li>
</ol>
<p>We’ll look at each one.</p>
</section>
<section id="pd-concat">
<h2><span class="section-number">5.7.3. </span><code class="docutils literal notranslate"><span class="pre">pd.concat</span></code><a class="headerlink" href="#pd-concat" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code> function is used to stack two or more DataFrames
together.</p>
<p>An example of when you might want to do this is if you have monthly data
in separate files on your computer and would like to have 1 year of data
in a single DataFrame.</p>
<p>The first argument to <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code> is a list of DataFrames to be
stitched together.</p>
<p>The other commonly used argument is named <code class="docutils literal notranslate"><span class="pre">axis</span></code>.</p>
<p>As we have seen before, many pandas functions have an <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument
that specifies whether a particular operation should happen down rows
(<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>) or along columns (<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>).</p>
<p>In the context of <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code>, setting <code class="docutils literal notranslate"><span class="pre">axis=0</span></code> (the default case)
will stack DataFrames on top of one another while <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> stacks them
side by side.</p>
<p>We’ll look at each case separately.</p>
<section id="axis-0">
<h3><span class="section-number">5.7.3.1. </span><code class="docutils literal notranslate"><span class="pre">axis=0</span></code><a class="headerlink" href="#axis-0" title="Permalink to this heading">#</a></h3>
<p>When we call <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code> and set <code class="docutils literal notranslate"><span class="pre">axis=0</span></code>, the list of DataFrames
passed in the first argument will be stacked on top of one another.</p>
<p>Let’s try it out here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># equivalent to pd.concat([wdi2017, sq_miles]) -- axis=0 is default</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:2: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>GDP</th>
      <th>GovExpend</th>
      <th>Imports</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>1.868164</td>
      <td>0.372665</td>
      <td>0.600031</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>3.883870</td>
      <td>0.745579</td>
      <td>1.666348</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>2.818704</td>
      <td>0.549538</td>
      <td>0.933145</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>17.348627</td>
      <td>2.405743</td>
      <td>3.069954</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice a few things:</p>
<ul>
<li><dl style='margin: 20px 0;'>
<dt>The number of rows in the output is the total number</dt>
<dd>
of rows in all inputs. The labels are all from the original
DataFrames.  
</dd>
</dl>
</li>
<li><p>The column labels are all the distinct column labels from all the inputs.</p></li>
<li><p>For columns that appeared only in one input, the value for all row labels
originating from a different input is equal to <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (marked as missing).</p></li>
</ul>
</section>
<section id="axis-1">
<h3><span class="section-number">5.7.3.2. </span><code class="docutils literal notranslate"><span class="pre">axis=1</span></code><a class="headerlink" href="#axis-1" title="Permalink to this heading">#</a></h3>
<p>In this example, concatenating by stacking
side-by-side makes more sense.</p>
<p>We accomplish this by passing <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> to <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.6000</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice here that</p>
<ul class="simple">
<li><p>The index entries are all unique index entries that appeared in any DataFrame.</p></li>
<li><p>The column labels are all column labels from the inputs.</p></li>
<li><p>As <code class="docutils literal notranslate"><span class="pre">wdi2017</span></code> didn’t have a <code class="docutils literal notranslate"><span class="pre">Russia</span></code> row, the value for all of its columns
is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p></li>
</ul>
<p>Now we can answer one of our questions from above: What is
Consumption per square mile?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">temp</span><span class="p">[</span><span class="s2">&quot;Consumption&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;sq_miles&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Canada             0.288283
Germany           15.416124
Russia                  NaN
United Kingdom    19.328569
United States      3.162965
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pd-merge">
<h2><span class="section-number">5.7.4. </span><code class="docutils literal notranslate"><span class="pre">pd.merge</span></code><a class="headerlink" href="#pd-merge" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> operates on two DataFrames at a time and is primarily used
to bring columns from one DataFrame into another, <em>aligning</em> data based
on one or more “key” columns.</p>
<p>This is a somewhat difficult concept to grasp by reading, so let’s look at some
examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The output here looks very similar to what we saw with <code class="docutils literal notranslate"><span class="pre">concat</span></code> and
<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>, except that the row for <code class="docutils literal notranslate"><span class="pre">Russia</span></code> does not appear.</p>
<p>We will talk more about why this happened soon.</p>
<p>For now, let’s look at a slightly more intriguing example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2016_17</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>0.364899</td>
      <td>1.058426</td>
      <td>0.576394</td>
      <td>0.575775</td>
      <td>1.814016</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.734014</td>
      <td>2.075615</td>
      <td>1.844949</td>
      <td>1.589495</td>
      <td>3.801859</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.550596</td>
      <td>1.772348</td>
      <td>0.816792</td>
      <td>0.901494</td>
      <td>2.768241</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.407981</td>
      <td>11.722133</td>
      <td>2.219937</td>
      <td>2.936004</td>
      <td>16.972348</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here’s how we think about what happened:</p>
<ul class="simple">
<li><p>The data in <code class="docutils literal notranslate"><span class="pre">wdi2016_17</span></code> is copied over exactly as is.</p></li>
<li><p>Because <code class="docutils literal notranslate"><span class="pre">country</span></code> was on the index for both DataFrames, it is on the
index of the output.</p></li>
<li><p>We lost the year on the index – we’ll work on getting it back below.</p></li>
<li><p>The additional column in <code class="docutils literal notranslate"><span class="pre">sq_miles</span></code> was added to column labels for the
output.</p></li>
<li><p>The data from the <code class="docutils literal notranslate"><span class="pre">sq_miles</span></code> column was added to the output by looking up
rows where the <code class="docutils literal notranslate"><span class="pre">country</span></code> in the two DataFrames lined up.</p>
<ul>
<li><p>Note that all the countries appeared twice, and the data in <code class="docutils literal notranslate"><span class="pre">sq_miles</span></code> was repeated. This is because <code class="docutils literal notranslate"><span class="pre">wdi2016_17</span></code> had two rows for each country.</p></li>
<li><p>Also note that because <code class="docutils literal notranslate"><span class="pre">Russia</span></code> did not appear in <code class="docutils literal notranslate"><span class="pre">wdi2016_17</span></code>, the value <code class="docutils literal notranslate"><span class="pre">sq_miles.loc[&quot;Russia&quot;]</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">6.6</span></code>) is not used the output.</p></li>
</ul>
</li>
</ul>
<p>How do we get the year back?</p>
<p>We must first call <code class="docutils literal notranslate"><span class="pre">reset_index</span></code> on <code class="docutils literal notranslate"><span class="pre">wdi2016_17</span></code> so
that in the first step when all columns are copied over, <code class="docutils literal notranslate"><span class="pre">year</span></code> is included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2016_17</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Canada</td>
      <td>2017</td>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Canada</td>
      <td>2016</td>
      <td>0.364899</td>
      <td>1.058426</td>
      <td>0.576394</td>
      <td>0.575775</td>
      <td>1.814016</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Germany</td>
      <td>2017</td>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Germany</td>
      <td>2016</td>
      <td>0.734014</td>
      <td>2.075615</td>
      <td>1.844949</td>
      <td>1.589495</td>
      <td>3.801859</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>4</th>
      <td>United Kingdom</td>
      <td>2017</td>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>5</th>
      <td>United Kingdom</td>
      <td>2016</td>
      <td>0.550596</td>
      <td>1.772348</td>
      <td>0.816792</td>
      <td>0.901494</td>
      <td>2.768241</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>6</th>
      <td>United States</td>
      <td>2017</td>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>United States</td>
      <td>2016</td>
      <td>2.407981</td>
      <td>11.722133</td>
      <td>2.219937</td>
      <td>2.936004</td>
      <td>16.972348</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="multiple-columns">
<h3><span class="section-number">5.7.4.1. </span>Multiple Columns<a class="headerlink" href="#multiple-columns" title="Permalink to this heading">#</a></h3>
<p>Sometimes, we need to merge multiple columns.</p>
<p>For example our <code class="docutils literal notranslate"><span class="pre">pop</span></code> and <code class="docutils literal notranslate"><span class="pre">wdi2016_17</span></code> DataFrames both have observations
organized by country and year.</p>
<p>To properly merge these datasets, we would need to align the data by
both country and year.</p>
<p>We pass a list to the <code class="docutils literal notranslate"><span class="pre">on</span></code> argument to accomplish this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2016_17</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>Population</th>
    </tr>
    <tr>
      <th>country</th>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Canada</th>
      <th>2017</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>36.540268</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.364899</td>
      <td>1.058426</td>
      <td>0.576394</td>
      <td>0.575775</td>
      <td>1.814016</td>
      <td>36.109487</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Germany</th>
      <th>2017</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>82.657002</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.734014</td>
      <td>2.075615</td>
      <td>1.844949</td>
      <td>1.589495</td>
      <td>3.801859</td>
      <td>82.348669</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">United Kingdom</th>
      <th>2017</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>66.058859</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.550596</td>
      <td>1.772348</td>
      <td>0.816792</td>
      <td>0.901494</td>
      <td>2.768241</td>
      <td>65.595565</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">United States</th>
      <th>2017</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>325.147121</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>2.407981</td>
      <td>11.722133</td>
      <td>2.219937</td>
      <td>2.936004</td>
      <td>16.972348</td>
      <td>323.071342</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, we can answer more of our questions from above: What is GDP per capita (per
person) for each country in each year? How about Consumption per person?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi_pop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2016_17</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
<span class="n">wdi_pop</span><span class="p">[</span><span class="s2">&quot;GDP&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wdi_pop</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country         year
Canada          2017    0.051126
                2016    0.050237
Germany         2017    0.046988
                2016    0.046168
United Kingdom  2017    0.042670
                2016    0.042202
United States   2017    0.053356
                2016    0.052534
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi_pop</span><span class="p">[</span><span class="s2">&quot;Consumption&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wdi_pop</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country         year
Canada          2017    0.029980
                2016    0.029312
Germany         2017    0.025551
                2016    0.025205
United Kingdom  2017    0.027387
                2016    0.027019
United States   2017    0.036966
                2016    0.036283
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><a id='exercise-0'></a></p>
<blockquote>
<div><p>See exercise 1 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
</section>
</section>
<section id="arguments-to-merge">
<h2><span class="section-number">5.7.5. </span>Arguments to <code class="docutils literal notranslate"><span class="pre">merge</span></code><a class="headerlink" href="#arguments-to-merge" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> function can take many optional arguments.</p>
<p>We’ll talk about a few of the most commonly-used ones here and refer you
to the
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.merge.html#pandas.merge">documentation</a>
for more details.</p>
<p>We’ll follow the pandas convention and refer to the first argument to
<code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> as <code class="docutils literal notranslate"><span class="pre">left</span></code> and call the second <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p>
<section id="on">
<h3><span class="section-number">5.7.5.1. </span><code class="docutils literal notranslate"><span class="pre">on</span></code><a class="headerlink" href="#on" title="Permalink to this heading">#</a></h3>
<p>We have already seen this one used before, but we want to point out that on
is optional.</p>
<p>If nothing is given for this argument, pandas will use <strong>all</strong> columns
in <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> with the same name.</p>
<p>In our example, <code class="docutils literal notranslate"><span class="pre">country</span></code> is the only column that appears in both
DataFrames, so it is used for <code class="docutils literal notranslate"><span class="pre">on</span></code> if we don’t pass anything.</p>
<p>The following two are equivalent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if we move index back to columns, the `on` is un-necessary</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">sq_miles</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Canada</td>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Germany</td>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>2</th>
      <td>United Kingdom</td>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>3</th>
      <td>United States</td>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="left-on-right-on">
<h3><span class="section-number">5.7.5.2. </span><code class="docutils literal notranslate"><span class="pre">left_on</span></code>, <code class="docutils literal notranslate"><span class="pre">right_on</span></code><a class="headerlink" href="#left-on-right-on" title="Permalink to this heading">#</a></h3>
<p>Above, we used the <code class="docutils literal notranslate"><span class="pre">on</span></code> argument to identify a column in both <code class="docutils literal notranslate"><span class="pre">left</span></code>
and <code class="docutils literal notranslate"><span class="pre">right</span></code> that was used to align data.</p>
<p>Sometimes, both DataFrames don’t have the same name for this column.</p>
<p>In that case, we use the <code class="docutils literal notranslate"><span class="pre">left_on</span></code> and <code class="docutils literal notranslate"><span class="pre">right_on</span></code> arguments, passing
the proper column name(s) to align the data.</p>
<p>We’ll show you an example below, but it is somewhat silly as our
DataFrames do both have the <code class="docutils literal notranslate"><span class="pre">country</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="left-index-right-index">
<h3><span class="section-number">5.7.5.3. </span><code class="docutils literal notranslate"><span class="pre">left_index</span></code>, <code class="docutils literal notranslate"><span class="pre">right_index</span></code><a class="headerlink" href="#left-index-right-index" title="Permalink to this heading">#</a></h3>
<p>Sometimes, as in our example, the key used to align data is actually in the
index instead of one of the columns.</p>
<p>In this case, we can use the <code class="docutils literal notranslate"><span class="pre">left_index</span></code> or <code class="docutils literal notranslate"><span class="pre">right_index</span></code> arguments.</p>
<p>We should only set these values to a boolean (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p>
<p>Let’s practice with this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="how">
<h3><span class="section-number">5.7.5.4. </span><code class="docutils literal notranslate"><span class="pre">how</span></code><a class="headerlink" href="#how" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">how</span></code> is perhaps the most powerful, but most conceptually
difficult of the arguments we will cover.</p>
<p>This argument controls which values from the key column(s) appear in the
output.</p>
<p>The 4 possible options for this argument are summarized in
the image below.</p>
<img src="https://datascience.quantecon.org/assets/_static/merge_files/merge_venns.png" alt="merge\_venns.png" style="">
<p>In words, we have:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">left</span></code>: Default and what we described above. It uses
the keys from the <code class="docutils literal notranslate"><span class="pre">left</span></code> DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">right</span></code>: Output will contain all keys from <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inner</span></code>: The output will only contain keys that appear in <em>both</em>
<code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outer</span></code>: The output will contain any key found in either <code class="docutils literal notranslate"><span class="pre">left</span></code>
or <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p></li>
</ul>
<p>In addition to the above, we will use the following two DataFrames to
illustrate the <code class="docutils literal notranslate"><span class="pre">how</span></code> option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi2017_no_US</span> <span class="o">=</span> <span class="n">wdi2017</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;United States&quot;</span><span class="p">)</span>
<span class="n">wdi2017_no_US</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sq_miles_no_germany</span> <span class="o">=</span> <span class="n">sq_miles</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Germany&quot;</span><span class="p">)</span>
<span class="n">sq_miles_no_germany</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>United States</th>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, let’s see all the possible <code class="docutils literal notranslate"><span class="pre">how</span></code> options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># default</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># notice ``Russia`` is included</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># notice no United States or Russia</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017_no_US</span><span class="p">,</span> <span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># includes all 5, even though they don&#39;t all appear in either DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wdi2017_no_US</span><span class="p">,</span> <span class="n">sq_miles_no_germany</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id='exercise-1'></a></p>
<blockquote>
<div><p>See exercise 2 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p><a id='exercise-2'></a></p>
<blockquote>
<div><p>See exercise 3 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
</section>
<section id="df-merge-df2">
<h3><span class="section-number">5.7.5.5. </span><code class="docutils literal notranslate"><span class="pre">df.merge(df2)</span></code><a class="headerlink" href="#df-merge-df2" title="Permalink to this heading">#</a></h3>
<p>Note that the DataFrame type has a <code class="docutils literal notranslate"><span class="pre">merge</span></code> <em>method</em>.</p>
<p>It is the same as the function we have been working with, but passes the
DataFrame before the period as <code class="docutils literal notranslate"><span class="pre">left</span></code>.</p>
<p>Thus <code class="docutils literal notranslate"><span class="pre">df.merge(other)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">pd.merge(df,</span> <span class="pre">other)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi2017</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Russia</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.6000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="df-join">
<h2><span class="section-number">5.7.6. </span><code class="docutils literal notranslate"><span class="pre">df.join</span></code><a class="headerlink" href="#df-join" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">join</span></code> method for a DataFrame is very similar to the <code class="docutils literal notranslate"><span class="pre">merge</span></code>
method described above, but only allows you to use the index of the
<code class="docutils literal notranslate"><span class="pre">right</span></code> DataFrame as the join key.</p>
<p>Thus, <code class="docutils literal notranslate"><span class="pre">left.join(right,</span> <span class="pre">on=&quot;country&quot;)</span></code> is equivalent to calling
<code class="docutils literal notranslate"><span class="pre">pd.merge(left,</span> <span class="pre">right,</span> <span class="pre">left_on=&quot;country&quot;,</span> <span class="pre">right_index=True)</span></code>.</p>
<p>The implementation of the <code class="docutils literal notranslate"><span class="pre">join</span></code> method calls <code class="docutils literal notranslate"><span class="pre">merge</span></code> internally,
but sets the <code class="docutils literal notranslate"><span class="pre">left_on</span></code> and <code class="docutils literal notranslate"><span class="pre">right_index</span></code> arguments for you.</p>
<p>You can do anything with <code class="docutils literal notranslate"><span class="pre">df.join</span></code> that you can do with
<code class="docutils literal notranslate"><span class="pre">df.merge</span></code>, but df.join<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">more</span> <span class="pre">convenient</span> <span class="pre">to</span> <span class="pre">use</span> <span class="pre">if</span> <span class="pre">the</span> <span class="pre">keys</span> <span class="pre">of</span></code>right`
are in the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi2017</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sq_miles</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi2017</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sq_miles</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GovExpend</th>
      <th>Consumption</th>
      <th>Exports</th>
      <th>Imports</th>
      <th>GDP</th>
      <th>sq_miles</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Canada</th>
      <td>0.372665</td>
      <td>1.095475</td>
      <td>0.582831</td>
      <td>0.600031</td>
      <td>1.868164</td>
      <td>3.8000</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>0.745579</td>
      <td>2.112009</td>
      <td>1.930563</td>
      <td>1.666348</td>
      <td>3.883870</td>
      <td>0.1370</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>0.549538</td>
      <td>1.809154</td>
      <td>0.862629</td>
      <td>0.933145</td>
      <td>2.818704</td>
      <td>0.0936</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>2.405743</td>
      <td>12.019266</td>
      <td>2.287071</td>
      <td>3.069954</td>
      <td>17.348627</td>
      <td>3.8000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="case-study">
<h2><span class="section-number">5.7.7. </span>Case Study<a class="headerlink" href="#case-study" title="Permalink to this heading">#</a></h2>
<p>Let’s put these tools to practice by loading some real datasets and
seeing how these functions can be applied.</p>
<p>We’ll analyze ratings of books from the website <a class="reference external" href="https://www.goodreads.com/">Goodreads</a>.</p>
<p>We accessed the data <a class="reference external" href="https://github.com/zygmuntz/goodbooks-10k">here</a>.</p>
<p>Let’s load it up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;goodreads_ratings&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>book_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>258</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>4081</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>260</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>9296</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>2318</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 5976479 entries, 0 to 5976478
Data columns (total 3 columns):
user_id    int64
book_id    int64
rating     int64
dtypes: int64(3)
memory usage: 136.8 MB
</pre></div>
</div>
</div>
</div>
<p>We can already do some interesting things with just the ratings data.</p>
<p>Let’s see how many ratings of each number are in our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3a753aab54c2520c81c85e424a1447bd948abcd2a9cd41a9eba3fcabc4f7ec31.png" src="../../_images/3a753aab54c2520c81c85e424a1447bd948abcd2a9cd41a9eba3fcabc4f7ec31.png" />
</div>
</div>
<p>Let’s also see how many users have rated <code class="docutils literal notranslate"><span class="pre">N</span></code> books, for all <code class="docutils literal notranslate"><span class="pre">N</span></code>
possible.</p>
<p>To do this, we will use <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> twice (can you think of why?).</p>
<p>We will see a more flexible way of performing similar grouped operations in
a future lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users_by_n</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>  <span class="c1"># Series. Index: user_id, value: n ratings by user</span>
    <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>  <span class="c1"># Series. Index: n_ratings by user, value: N_users with this many ratings</span>
    <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>    <span class="c1"># Sort our Series by the index (number of ratings)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>   <span class="c1"># Dataframe with columns `index` (from above) and `user_id`</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;N_ratings&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;N_users&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="n">users_by_n</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>N_ratings</th>
      <th>N_users</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>23</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>24</td>
      <td>11</td>
    </tr>
    <tr>
      <th>6</th>
      <td>25</td>
      <td>13</td>
    </tr>
    <tr>
      <th>7</th>
      <td>26</td>
      <td>23</td>
    </tr>
    <tr>
      <th>8</th>
      <td>27</td>
      <td>34</td>
    </tr>
    <tr>
      <th>9</th>
      <td>28</td>
      <td>26</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s look at some statistics on that dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users_by_n</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>N_ratings</th>
      <th>N_users</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>181.00000</td>
      <td>181.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>109.01105</td>
      <td>295.160221</td>
    </tr>
    <tr>
      <th>std</th>
      <td>52.41342</td>
      <td>309.461848</td>
    </tr>
    <tr>
      <th>min</th>
      <td>19.00000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>64.00000</td>
      <td>40.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>109.00000</td>
      <td>158.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>154.00000</td>
      <td>538.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>200.00000</td>
      <td>964.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can see the same data visually in a box plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users_by_n</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N_ratings       AxesSubplot(0.125,0.125;0.352273x0.755)
N_users      AxesSubplot(0.547727,0.125;0.352273x0.755)
dtype: object
</pre></div>
</div>
<img alt="../../_images/92f172fd849f409aeace2ab73aea366fa62fbd90c85655fee0cdb0070192c120.png" src="../../_images/92f172fd849f409aeace2ab73aea366fa62fbd90c85655fee0cdb0070192c120.png" />
</div>
</div>
<p>Let’s practice applying the want operator…</p>
<p><strong>Want</strong>: Determine whether a relationship between the number of
ratings a user has written and the distribution of the ratings exists. (Maybe we
are an author hoping to inflate our ratings and wonder if we should
target “more experienced” Goodreads users, or focus on newcomers.)</p>
<p>Let’s start from the result and work our way backwards:</p>
<ol class="arabic simple">
<li><p>We can answer our question if we have two similar DataFrames:</p></li>
</ol>
<ul class="simple">
<li><p>All ratings by the <code class="docutils literal notranslate"><span class="pre">N</span></code> (e.g. 5) users with the most ratings</p></li>
<li><p>All ratings by the <code class="docutils literal notranslate"><span class="pre">N</span></code> users with the least number of
ratings</p></li>
</ul>
<ol class="arabic simple">
<li><p>To get that, we will need to extract rows of <code class="docutils literal notranslate"><span class="pre">ratings</span></code> with
<code class="docutils literal notranslate"><span class="pre">user_id</span></code> associated with the <code class="docutils literal notranslate"><span class="pre">N</span></code> most and least prolific raters</p></li>
<li><p>For that, we need the most and least active <code class="docutils literal notranslate"><span class="pre">user_id</span></code>s</p></li>
<li><p>To get that info, we need a count of how many ratings each user left.</p></li>
</ol>
<ul class="simple">
<li><p>We can get that with <code class="docutils literal notranslate"><span class="pre">df[&quot;user_id&quot;].value_counts()</span></code>, so let’s
start there.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># step 4</span>
<span class="n">n_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">n_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30944    200
12874    200
52036    199
28158    199
12381    199
Name: user_id, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># step 3</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">most_prolific_users</span> <span class="o">=</span> <span class="n">n_ratings</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">least_prolific_users</span> <span class="o">=</span> <span class="n">n_ratings</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># step 2</span>
<span class="n">active_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">most_prolific_users</span><span class="p">),</span> <span class="p">:]</span>
<span class="n">inactive_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">least_prolific_users</span><span class="p">),</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># step 1 -- get the answer!</span>
<span class="n">active_ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of ratings by most active users&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2a2fa0dcc0&gt;
</pre></div>
</div>
<img alt="../../_images/ba09c6cac1d81325d4779973302206bcce343211bac0ceadd5d2227e8c5132ee.png" src="../../_images/ba09c6cac1d81325d4779973302206bcce343211bac0ceadd5d2227e8c5132ee.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inactive_ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of ratings by least active users&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2a2cbe06d8&gt;
</pre></div>
</div>
<img alt="../../_images/e2bec94991adba21714fb9493b369ce4a3e69709ac9fa5ac9885d3fb6ba95d55.png" src="../../_images/e2bec94991adba21714fb9493b369ce4a3e69709ac9fa5ac9885d3fb6ba95d55.png" />
</div>
</div>
<p>Nice! From the picture above, the new users look much more
likely to leave 5 star ratings than more experienced users.</p>
<section id="book-data">
<h3><span class="section-number">5.7.7.1. </span>Book Data<a class="headerlink" href="#book-data" title="Permalink to this heading">#</a></h3>
<p>We know what you are probably thinking: “Isn’t this a lecture on merging?
Why are we only using one dataset?”</p>
<p>We hear you.</p>
<p>Let’s also load a dataset containing information on the actual books.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">books</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;goodreads_books&quot;</span><span class="p">)</span>
<span class="c1"># we only need a few of the columns</span>
<span class="n">books</span> <span class="o">=</span> <span class="n">books</span><span class="p">[[</span><span class="s2">&quot;book_id&quot;</span><span class="p">,</span> <span class="s2">&quot;authors&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape: &quot;</span><span class="p">,</span> <span class="n">books</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dtypes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="o">.</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">books</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape:  (10000, 3)
dtypes:
book_id     int64
authors    object
title      object
dtype: object
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>book_id</th>
      <th>authors</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Suzanne Collins</td>
      <td>The Hunger Games (The Hunger Games, #1)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>J.K. Rowling, Mary GrandPré</td>
      <td>Harry Potter and the Sorcerer's Stone (Harry P...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Stephenie Meyer</td>
      <td>Twilight (Twilight, #1)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Harper Lee</td>
      <td>To Kill a Mockingbird</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>F. Scott Fitzgerald</td>
      <td>The Great Gatsby</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We could do similar interesting things with just the books dataset,
but we will skip it for now and merge them together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rated_books</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">books</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s see which books have been most often rated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_rated_books_id</span> <span class="o">=</span> <span class="n">rated_books</span><span class="p">[</span><span class="s2">&quot;book_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">most_rated_books</span> <span class="o">=</span> <span class="n">rated_books</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rated_books</span><span class="p">[</span><span class="s2">&quot;book_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">most_rated_books_id</span><span class="p">),</span> <span class="p">:]</span>
<span class="nb">list</span><span class="p">(</span><span class="n">most_rated_books</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Harry Potter and the Prisoner of Azkaban (Harry Potter, #3)&#39;,
 &quot;Harry Potter and the Sorcerer&#39;s Stone (Harry Potter, #1)&quot;,
 &#39;Harry Potter and the Chamber of Secrets (Harry Potter, #2)&#39;,
 &#39;The Great Gatsby&#39;,
 &#39;To Kill a Mockingbird&#39;,
 &#39;The Hobbit&#39;,
 &#39;Twilight (Twilight, #1)&#39;,
 &#39;The Hunger Games (The Hunger Games, #1)&#39;,
 &#39;Catching Fire (The Hunger Games, #2)&#39;,
 &#39;Mockingjay (The Hunger Games, #3)&#39;]
</pre></div>
</div>
</div>
</div>
<p>Let’s use our <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> knowledge to compute the average rating
for each of these books.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_rated_books</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rating</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Catching Fire (The Hunger Games, #2)</th>
      <td>4.133422</td>
    </tr>
    <tr>
      <th>Harry Potter and the Chamber of Secrets (Harry Potter, #2)</th>
      <td>4.229418</td>
    </tr>
    <tr>
      <th>Harry Potter and the Prisoner of Azkaban (Harry Potter, #3)</th>
      <td>4.418732</td>
    </tr>
    <tr>
      <th>Harry Potter and the Sorcerer's Stone (Harry Potter, #1)</th>
      <td>4.351350</td>
    </tr>
    <tr>
      <th>Mockingjay (The Hunger Games, #3)</th>
      <td>3.853131</td>
    </tr>
    <tr>
      <th>The Great Gatsby</th>
      <td>3.772224</td>
    </tr>
    <tr>
      <th>The Hobbit</th>
      <td>4.148477</td>
    </tr>
    <tr>
      <th>The Hunger Games (The Hunger Games, #1)</th>
      <td>4.279707</td>
    </tr>
    <tr>
      <th>To Kill a Mockingbird</th>
      <td>4.329369</td>
    </tr>
    <tr>
      <th>Twilight (Twilight, #1)</th>
      <td>3.214341</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>These ratings seem surprisingly low, given that they are the most often
rated books on Goodreads.</p>
<p>I wonder what the bottom of the distribution looks like…</p>
<p><a id='exercise-3'></a></p>
<blockquote>
<div><p>See exercise 4 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p>Let’s compute the average number of ratings for each book in our sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">average_ratings</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">rated_books</span>
    <span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">average_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rating</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>The Complete Calvin and Hobbes</th>
      <td>4.829876</td>
    </tr>
    <tr>
      <th>ESV Study Bible</th>
      <td>4.818182</td>
    </tr>
    <tr>
      <th>Attack of the Deranged Mutant Killer Monster Snow Goons</th>
      <td>4.768707</td>
    </tr>
    <tr>
      <th>The Indispensable Calvin and Hobbes</th>
      <td>4.766355</td>
    </tr>
    <tr>
      <th>The Revenge of the Baby-Sat</th>
      <td>4.761364</td>
    </tr>
    <tr>
      <th>There's Treasure Everywhere: A Calvin and Hobbes Collection</th>
      <td>4.760456</td>
    </tr>
    <tr>
      <th>The Authoritative Calvin and Hobbes: A Calvin and Hobbes Treasury</th>
      <td>4.757202</td>
    </tr>
    <tr>
      <th>It's a Magical World: A Calvin and Hobbes Collection</th>
      <td>4.747396</td>
    </tr>
    <tr>
      <th>Harry Potter Boxed Set, Books 1-5 (Harry Potter, #1-5)</th>
      <td>4.736842</td>
    </tr>
    <tr>
      <th>The Calvin and Hobbes Tenth Anniversary Book</th>
      <td>4.728528</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What does the overall distribution of average ratings look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot a kernel density estimate of average ratings</span>
<span class="n">average_ratings</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># or a histogram</span>
<span class="n">average_ratings</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2a1ee545c0&gt;
</pre></div>
</div>
<img alt="../../_images/640f2e7d4a396d327b1a5edc13cfb3fa70a94cb9e0f9026b0d4cf8525a5da097.png" src="../../_images/640f2e7d4a396d327b1a5edc13cfb3fa70a94cb9e0f9026b0d4cf8525a5da097.png" />
<img alt="../../_images/408b1816132678e6a2ee35a485328c6bf6f4d4b5d930c361ff0506aaf23467d6.png" src="../../_images/408b1816132678e6a2ee35a485328c6bf6f4d4b5d930c361ff0506aaf23467d6.png" />
</div>
</div>
<p>It looks like most books have an average rating of just below 4.</p>
</section>
</section>
<section id="extra-example-airline-delays">
<h2><span class="section-number">5.7.8. </span>Extra Example: Airline Delays<a class="headerlink" href="#extra-example-airline-delays" title="Permalink to this heading">#</a></h2>
<p>Let’s look at one more example.</p>
<p>This time, we will use a dataset from the <a class="reference external" href="https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&amp;DB_Short_Name=On-Time">Bureau of Transportation
Statistics</a>
that describes the cause of all US domestic flight delays
in November 2016:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">air_perf</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;airline_performance_dec16&quot;</span><span class="p">)[[</span><span class="s2">&quot;CRSDepTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Carrier&quot;</span><span class="p">,</span> <span class="s2">&quot;CarrierDelay&quot;</span><span class="p">,</span> <span class="s2">&quot;ArrDelay&quot;</span><span class="p">]]</span>
<span class="n">air_perf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">air_perf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 460949 entries, 0 to 460948
Data columns (total 4 columns):
CRSDepTime      460949 non-null datetime64[ns]
Carrier         460949 non-null object
CarrierDelay    460949 non-null float64
ArrDelay        452229 non-null float64
dtypes: datetime64[ns](1), float64(2), object(1)
memory usage: 14.1+ MB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRSDepTime</th>
      <th>Carrier</th>
      <th>CarrierDelay</th>
      <th>ArrDelay</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-12-18 15:58:00</td>
      <td>AA</td>
      <td>0.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-12-19 15:58:00</td>
      <td>AA</td>
      <td>0.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-12-20 15:58:00</td>
      <td>AA</td>
      <td>0.0</td>
      <td>-3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-12-21 15:58:00</td>
      <td>AA</td>
      <td>0.0</td>
      <td>-10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-12-22 15:58:00</td>
      <td>AA</td>
      <td>0.0</td>
      <td>-8.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Carrier</span></code> column identifies the airline and the <code class="docutils literal notranslate"><span class="pre">CarrierDelay</span></code>
reports the number of minutes of the total delay assigned as the
“carrier’s fault”.</p>
<p><strong>Want</strong>: Determine which airlines, on average, contribute most to
delays.</p>
<p>We can do this using <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_delays</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">air_perf</span>
    <span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;Carrier&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;CarrierDelay&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;CarrierDelay&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;CarrierDelay&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">avg_delays</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CarrierDelay</th>
    </tr>
    <tr>
      <th>Carrier</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F9</th>
      <td>7.856566</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>7.125663</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>6.705469</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>5.588006</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>4.674957</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>4.577753</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>4.368148</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>4.166264</td>
    </tr>
    <tr>
      <th>AA</th>
      <td>4.073358</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>3.342923</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The one issue with this dataset is that we don’t know what all those two
letter carrier codes are!</p>
<p>Thankfully, we have a second dataset that maps the two letter code
into the full airline name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carrier_code</span> <span class="o">=</span> <span class="n">qeds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;airline_carrier_codes&quot;</span><span class="p">)</span>
<span class="n">carrier_code</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
    </tr>
    <tr>
      <th>Code</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ZW</th>
      <td>Air Wisconsin Airlines Corp (1994 - )</td>
    </tr>
    <tr>
      <th>ZX</th>
      <td>Airbc Ltd. (1990 - 2000)</td>
    </tr>
    <tr>
      <th>ZX</th>
      <td>Air Georgian (2002 - )</td>
    </tr>
    <tr>
      <th>ZY</th>
      <td>Atlantic Gulf Airlines (1985 - 1986)</td>
    </tr>
    <tr>
      <th>ZYZ</th>
      <td>Skyway Aviation Inc. (1960 - 2002)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s merge these names so we know which airlines we should avoid
flying…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_delays_w_code</span> <span class="o">=</span> <span class="n">avg_delays</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">carrier_code</span><span class="p">)</span>
<span class="n">avg_delays_w_code</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;CarrierDelay&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CarrierDelay</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F9</th>
      <td>7.856566</td>
      <td>Frontier Airlines Inc. (1994 - )</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>7.125663</td>
      <td>ExpressJet Airlines Inc. (2012 - )</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>7.125663</td>
      <td>Atlantic Southeast Airlines (1993 - 2011)</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>6.705469</td>
      <td>SkyWest Airlines Inc. (2003 - )</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>5.588006</td>
      <td>JetBlue Airways (2000 - )</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>4.674957</td>
      <td>Delta Air Lines Inc. (1960 - )</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>4.577753</td>
      <td>Hawaiian Airlines Inc. (1960 - )</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>4.368148</td>
      <td>United Air Lines Inc. (1960 - )</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>4.166264</td>
      <td>Spirit Air Lines (1992 - )</td>
    </tr>
    <tr>
      <th>AA</th>
      <td>4.073358</td>
      <td>American Airlines Inc. (1960 - )</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>3.342923</td>
      <td>Virgin America (2007 - )</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>3.342923</td>
      <td>Aces Airlines (1992 - 2003)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Based on that information, which airlines would you avoid near
the holidays?</p>
</section>
<section id="visualizing-merge-operations">
<h2><span class="section-number">5.7.9. </span>Visualizing Merge Operations<a class="headerlink" href="#visualizing-merge-operations" title="Permalink to this heading">#</a></h2>
<p>As we did in the <a class="reference internal" href="reshape.html"><span class="doc std std-doc">reshape lecture</span></a>, we will visualize the
various merge operations using artificial DataFrames.</p>
<p>First, we create some dummy DataFrames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="s2">&quot;C1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;C2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;L2&quot;</span><span class="p">,</span> <span class="s2">&quot;L3&quot;</span><span class="p">,</span> <span class="s2">&quot;L4&quot;</span><span class="p">]</span>
<span class="p">)[[</span><span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is dfL: &quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfL</span><span class="p">)</span>

<span class="n">dfR</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="s2">&quot;C3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">]},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;R4&quot;</span><span class="p">]</span>
<span class="p">)[[</span><span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is dfR:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is dfL: 
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>L1</th>
      <td>A</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>B</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>A</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>C</td>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is dfR:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>R1</th>
      <td>A</td>
      <td>100</td>
    </tr>
    <tr>
      <th>R2</th>
      <td>B</td>
      <td>200</td>
    </tr>
    <tr>
      <th>R3</th>
      <td>C</td>
      <td>300</td>
    </tr>
    <tr>
      <th>R4</th>
      <td>D</td>
      <td>400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id1">
<h3><span class="section-number">5.7.9.1. </span><code class="docutils literal notranslate"><span class="pre">pd.concat</span></code><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Recall that calling <code class="docutils literal notranslate"><span class="pre">pd.concat(...,</span> <span class="pre">axis=0)</span></code> will stack DataFrames on top of
one another:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
      <th>Key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>L1</th>
      <td>1.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>A</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>2.0</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>B</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>3.0</td>
      <td>30.0</td>
      <td>NaN</td>
      <td>A</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>4.0</td>
      <td>40.0</td>
      <td>NaN</td>
      <td>C</td>
    </tr>
    <tr>
      <th>R1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>R2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>200.0</td>
      <td>B</td>
    </tr>
    <tr>
      <th>R3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>300.0</td>
      <td>C</td>
    </tr>
    <tr>
      <th>R4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>400.0</td>
      <td>D</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here’s how we might visualize that.</p>
<img src="https://datascience.quantecon.org/assets/_static/merge_files/concat_axis0.gif" alt="concat\_axis0.gif" style="">
<p>We can also set <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> to stack side by side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
      <th>Key</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>L1</th>
      <td>A</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>B</td>
      <td>2.0</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>A</td>
      <td>3.0</td>
      <td>30.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>C</td>
      <td>4.0</td>
      <td>40.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>R1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>R2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>B</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>R3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C</td>
      <td>300.0</td>
    </tr>
    <tr>
      <th>R4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>D</td>
      <td>400.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here’s how we might visualize that.</p>
<img src="https://datascience.quantecon.org/assets/_static/merge_files/concat_axis1.gif" alt="concat\_axis1.gif" style=""></section>
<section id="id2">
<h3><span class="section-number">5.7.9.2. </span><code class="docutils literal notranslate"><span class="pre">pd.merge</span></code><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>The animation below shows a visualization of what happens when we call</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfR</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Key&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>3</td>
      <td>30</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>2</td>
      <td>20</td>
      <td>200</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4</td>
      <td>40</td>
      <td>300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<img src="https://datascience.quantecon.org/assets/_static/merge_files/left_merge.gif" alt="left\_merge.gif" style="">
<p>Now, let’s focus on what happens when we set <code class="docutils literal notranslate"><span class="pre">how=&quot;right&quot;</span></code>.</p>
<p>Pay special attention to what happens when filling the output value for
the key <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfR</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>3.0</td>
      <td>30.0</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>2.0</td>
      <td>20.0</td>
      <td>200</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4.0</td>
      <td>40.0</td>
      <td>300</td>
    </tr>
    <tr>
      <th>4</th>
      <td>D</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<img src="https://datascience.quantecon.org/assets/_static/merge_files/right_merge.gif" alt="right\_merge.gif" style=""></section>
<section id="exercises-with-artificial-data">
<h3><span class="section-number">5.7.9.3. </span>Exercises With Artificial Data<a class="headerlink" href="#exercises-with-artificial-data" title="Permalink to this heading">#</a></h3>
<p><a id='exercise-4'></a></p>
<blockquote>
<div><p>See exercise 5 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p><a id='exercise-5'></a></p>
<blockquote>
<div><p>See exercise 6 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
<p><a id='exercise-6'></a></p>
<blockquote>
<div><p>See exercise 7 in the <span class="xref myst"><em>exercise list</em></span></p>
</div></blockquote>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">5.7.10. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p><a id='exerciselist-0'></a>
<strong>Exercise 1</strong></p>
<p>Use your new <code class="docutils literal notranslate"><span class="pre">merge</span></code> skills to answer the final question from above: What
is the population density of each country? How much does it change over
time?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 2</strong></p>
<p>Compare the <code class="docutils literal notranslate"><span class="pre">how=&quot;left&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">how=&quot;inner&quot;</span></code> options using the
DataFrames <code class="docutils literal notranslate"><span class="pre">wdi2017_no_US</span></code> and <code class="docutils literal notranslate"><span class="pre">sq_miles_no_germany</span></code>.</p>
<p>Are the different? How?</p>
<p>Will this happen for all pairs of DataFrames, or are <code class="docutils literal notranslate"><span class="pre">wdi2017_no_US</span></code> and
<code class="docutils literal notranslate"><span class="pre">sq_miles_no_germany</span></code> special in some way?</p>
<p>Also compare <code class="docutils literal notranslate"><span class="pre">how=&quot;right&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">how=&quot;outer&quot;</span></code> and answer the same
questions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 3</strong></p>
<p>Can you pick the correct argument for <code class="docutils literal notranslate"><span class="pre">how</span></code> such that <code class="docutils literal notranslate"><span class="pre">pd.merge(wdi2017,</span> <span class="pre">sq_miles,</span> <span class="pre">how=&quot;left&quot;)</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">pd.merge(sq_miles,</span> <span class="pre">wdi2017,</span> <span class="pre">how=XXX)</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 4</strong></p>
<p>Repeat the analysis above to determine the average rating for the books with the
<em>least</em> number ratings.</p>
<p>Is there a distinguishable difference in the average rating compared to
the most rated books?</p>
<p>Did you recognize any of the books?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 5</strong></p>
<p>In writing, describe what the output looks like when you do
<code class="docutils literal notranslate"><span class="pre">pd.concat([dfL,</span> <span class="pre">dfR],</span> <span class="pre">axis=1)</span></code> (see above and/or run the cell below).</p>
<p>Be sure to describe things like:</p>
<ul class="simple">
<li><p>What are the columns? What about columns with the same name?</p></li>
<li><p>What is the index?</p></li>
<li><p>Do any <code class="docutils literal notranslate"><span class="pre">NaN</span></code>s get introduced? If so, where? Why?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/ubuntu/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
      <th>Key</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>L1</th>
      <td>A</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>B</td>
      <td>2.0</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>A</td>
      <td>3.0</td>
      <td>30.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>C</td>
      <td>4.0</td>
      <td>40.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>R1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>R2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>B</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>R3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C</td>
      <td>300.0</td>
    </tr>
    <tr>
      <th>R4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>D</td>
      <td>400.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 6</strong></p>
<p>Determine what happens when you run each of the two cells below.</p>
<p>For each cell, answer the list of questions from the previous exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First code cell for above exercise</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfL</span><span class="p">,</span> <span class="n">dfL</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C1</th>
      <th>C2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>L1</th>
      <td>A</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>B</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>A</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>C</td>
      <td>4</td>
      <td>40</td>
    </tr>
    <tr>
      <th>L1</th>
      <td>A</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>L2</th>
      <td>B</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>L3</th>
      <td>A</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>L4</th>
      <td>C</td>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Second code cell for above exercise</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfR</span><span class="p">,</span> <span class="n">dfR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Key</th>
      <th>C3</th>
      <th>Key</th>
      <th>C3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>R1</th>
      <td>A</td>
      <td>100</td>
      <td>A</td>
      <td>100</td>
    </tr>
    <tr>
      <th>R2</th>
      <td>B</td>
      <td>200</td>
      <td>B</td>
      <td>200</td>
    </tr>
    <tr>
      <th>R3</th>
      <td>C</td>
      <td>300</td>
      <td>C</td>
      <td>300</td>
    </tr>
    <tr>
      <th>R4</th>
      <td>D</td>
      <td>400</td>
      <td>D</td>
      <td>400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
<p><strong>Exercise 7</strong></p>
<p>Describe in words why the output of <code class="docutils literal notranslate"><span class="pre">pd.merge(dfL,</span> <span class="pre">dfR,</span> <span class="pre">how=&quot;right&quot;)</span></code> has more rows than either <code class="docutils literal notranslate"><span class="pre">dfL</span></code> or <code class="docutils literal notranslate"><span class="pre">dfR</span></code>.</p>
<p>Run the cell below to see the output of that operation.</p>
<p>(<span class="xref myst"><em>back to text</em></span>)</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="reshape.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.6. </span>Reshape (opt)</p>
      </div>
    </a>
    <a class="right-next"
       href="groupby.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.8. </span>GroupBy (opt)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">5.7.1. Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-datasets">5.7.2. Combining Datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-concat">5.7.3. <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axis-0">5.7.3.1. <code class="docutils literal notranslate"><span class="pre">axis=0</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axis-1">5.7.3.2. <code class="docutils literal notranslate"><span class="pre">axis=1</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-merge">5.7.4. <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-columns">5.7.4.1. Multiple Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arguments-to-merge">5.7.5. Arguments to <code class="docutils literal notranslate"><span class="pre">merge</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#on">5.7.5.1. <code class="docutils literal notranslate"><span class="pre">on</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-on-right-on">5.7.5.2. <code class="docutils literal notranslate"><span class="pre">left_on</span></code>, <code class="docutils literal notranslate"><span class="pre">right_on</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-index-right-index">5.7.5.3. <code class="docutils literal notranslate"><span class="pre">left_index</span></code>, <code class="docutils literal notranslate"><span class="pre">right_index</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how">5.7.5.4. <code class="docutils literal notranslate"><span class="pre">how</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#df-merge-df2">5.7.5.5. <code class="docutils literal notranslate"><span class="pre">df.merge(df2)</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#df-join">5.7.6. <code class="docutils literal notranslate"><span class="pre">df.join</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study">5.7.7. Case Study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#book-data">5.7.7.1. Book Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-example-airline-delays">5.7.8. Extra Example: Airline Delays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-merge-operations">5.7.9. Visualizing Merge Operations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5.7.9.1. <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.7.9.2. <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-with-artificial-data">5.7.9.3. Exercises With Artificial Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">5.7.10. Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>